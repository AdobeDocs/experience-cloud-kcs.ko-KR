---
title: "구성 파일에 대한 설명 | AEM"
description: 설명
solution: Experience Manager
product: Experience Manager
applies-to: "Experience Manager"
keywords: “KCS”
resolution: Resolution
internal-notes: null
bug: false
article-created-by: Nayanika Chakravarty
article-created-date: "5/15/2023 7:12:42 PM"
article-published-by: Nayanika Chakravarty
article-published-date: "5/15/2023 9:15:03 PM"
version-number: 3
article-number: KA-17477
dynamics-url: "https://adobe-ent.crm.dynamics.com/main.aspx?forceUCI=1&pagetype=entityrecord&etn=knowledgearticle&id=9533da75-54f3-ed11-8848-6045bd006149"
source-git-commit: 5849b91a727e32ea993724a7a374eae98aaa7ffa
workflow-type: tm+mt
source-wordcount: '1884'
ht-degree: 0%

---

# 구성 파일에 대한 설명 | AEM

## 설명 {#description}

<b>환경</b>
Experience Manager
<b>문제/증상</b>
이 문서는 Adobe Managed Services에서 프로비저닝된 표준 기본 제공 디스패처 서버에 배포된 각 구성 파일을 분류하고 설명합니다. 사용, 명명 규칙 등

<b>이름 지정 규칙</b>

Apache 웹 서버는 include 또는 includeoptional 문을 사용하여 파일을 타깃팅할 때 파일 확장자가 무엇인지에 실제로 신경 쓰지 않습니다. 충돌과 혼동을 방지하는 이름으로 적절히 이름을 지정하면 많은 도움이 됩니다. 사용되는 이름은 파일이 적용되는 범위를 설명하며, 이 범위를 사용하면 작업이 편리해집니다. 모든 이름이 .conf로 지정되면 이 이름이 매우 복잡해집니다. 잘못 이름이 지정된 파일 및 확장자를 방지하려고 합니다.

다음은 일반적인 AMS 구성 디스패처에서 사용되는 다양한 사용자 지정 파일 확장자 및 이름 지정 규칙 목록입니다.

<u>conf.d/에 포함된 파일</u>


| 파일 | 파일 대상 | 설명 |
| --- | --- | --- |
| `<` 파일 이름`>` .conf | /etc/httpd/conf.d/ | 기본 Enterprise Linux 설치는 이 파일 확장자를 사용하고 폴더를 httpd.conf의 설정을 재정의할 위치로 포함하므로 Apache의 글로벌 수준에서 추가 기능을 추가할 수 있습니다. |
| `<` 파일 이름`>` .vhost | 스테이징됨: /etc/httpd/conf.d/available_vhosts/<br><br>활성:<br><br>/etc/httpd/conf.d/enabled_vhosts/<br><br><u style="box-sizing: border-box; border: 0 none">*참고: .vhost 파일은 enabled_vhosts 폴더에 복사되지 않지만 available_vhosts/ .vhost 파일의 상대 경로에 대한 symlink를 사용합니다.</u> | \*.vhost(가상 호스트) 파일은 `<` 가상 호스트 `>`  호스트 이름을 일치시키고 Apache가 다른 규칙으로 각 도메인 트래픽을 처리할 수 있도록 하는 항목입니다. .vhost 파일에서 rewrites, whitelisting 등과 같은 다른 파일이 포함됩니다. |
| `<` 파일 이름`>` _rewrite.rules | /etc/httpd/conf.d/rewrites/ | `*_rewrite.rules` 파일 저장 `mod_rewrite` vhost 파일에서 명시적으로 포함 및 사용할 규칙 |
| `<` 파일 이름`>` _whitelist.rules | /etc/httpd/conf.d/whitelists/ | \*_ipwhitelist.rules 파일은 \*.vhost 파일 내부에서 포함됩니다. 여기에는 IP regex 또는 허용 거부 규칙이 포함되어 있어 IP를 화이트리스트에 추가할 수 있습니다. IP 주소를 기반으로 가상 호스트 보기를 제한하려는 경우 이러한 파일 중 하나를 생성하여 \*.vhost 파일에서 포함시킵니다 |


<u>conf.modules.d/에 포함된 파일</u>


| 파일 | 파일 대상 | 설명 |
| --- | --- | --- |
| `<` 파일 이름`>` .any | /etc/httpd/conf.dispatcher.d/ | AEM Dispatcher Apache 모듈은 설정을 \*.any 파일에서 가져옵니다. 기본 상위 포함 파일은 conf.dispatcher.d/dispatcher.any입니다. |
| `<` 파일 이름`>` _farm.any | 스테이징됨:<br><br>/etc/httpd/conf.dispatcher.d/available_farms/<br><br>활성:<br><br>/etc/httpd/conf.dispatcher.d/enabled_farms/<br><br><u style="box-sizing: border-box; border: 0 none">*참고: 이러한 팜 파일은 enabled_farms 폴더에 복사되지 않지만 available_farms/의 상대 경로에 대한 symlink를 사용합니다. _farm.any 파일</u>\*_ farm.any 파일은 conf.dispatcher.d/dispatcher.any 파일 내에 포함되어 있습니다. 이러한 부모 팜 파일은 각 렌더링 또는 웹 사이트 유형에 대한 모듈 동작을 제어하기 위해 존재합니다. 파일은 available_farms 디렉토리에 생성되고 enabled_farms 디렉토리에 symlink를 사용하여 활성화됩니다.<br><br><br><br>dispatcher.any 파일의 이름별로 자동으로 포함됩니다.<br><br><br><br>기준 팜 파일은 000으로 시작합니다._먼저 로드되었는지 확인합니다.<br><br>사용자 지정 팜 파일은 100에서 번호 체계를 시작하여 후에 로드해야 합니다_ 적절한 포함 동작을 보장합니다. |
| `<` 파일 이름`>` _filters.any | /etc/httpd/conf.dispatcher.d/filters/ | \*_filters.any 파일은 conf.dispatcher.d/enabled_farms/\*_farm.any 파일 내부에서 포함됩니다. 각 팜에는 필터링해야 하는 트래픽을 변경하고 렌더러로 만들지 않는 규칙 세트가 있습니다. |
| `<` 파일 이름`>` _vhosts.any | /etc/httpd/conf.dispatcher.d/vhosts/ | \*_vhosts.any 파일은 conf.dispatcher.d/enabled_farms/\*_farm.any 파일 내부에서 포함됩니다. 이러한 파일은 해당 요청을 제공하는 데 사용할 렌더러를 결정하기 위해 blob 일치로 일치할 호스트 이름 또는 URI 경로 목록입니다 |
| `<` 파일 이름`>` _cache.any | /etc/httpd/conf.dispatcher.d/cache/ | \*_cache.any 파일은 conf.dispatcher.d/enabled_farms/\*_farm.any 파일 내부에서 포함됩니다. 이러한 파일은 캐시되는 항목과 캐시되지 않는 항목을 지정합니다 |
| `<` 파일 이름`>` _invalidate_allowed.any | /etc/httpd/conf.dispatcher.d/cache/ | \*_invalidate_allowed.any 파일은 conf.dispatcher.d/enabled_farms/\*_farm.any 파일 내에 포함됩니다. 플러시 및 무효화 요청을 보낼 수 있는 IP 주소를 지정합니다. |
| `<` 파일 이름`>` _clientheaders.any | /etc/httpd/conf.dispatcher.d/clientheaders/ | \*_clientheaders.any 파일은 conf.dispatcher.d/enabled_farms/\*_farm.any 파일 내에 포함됩니다. 각 렌더러에 전달해야 하는 클라이언트 헤더를 지정합니다. |
| `<` 파일 이름`>` _renders.any | /etc/httpd/conf.dispatcher.d/renders/ | \*_renders.any 파일은 conf.dispatcher.d/enabled_farms/\*_farm.any 파일 내에 포함됩니다. 각 렌더러에 대한 IP, 포트 및 시간 제한 설정을 지정합니다. 적절한 렌더러는 디스패처가 요청을 가져오기/프록시할 수 있는 livecycle 서버나 모든 AEM 시스템일 수 있습니다. |


<b>문제 방지</b>

명명 규칙을 따르면, 치명적인 결과를 초래할 수 있는 실수를 쉽게 하지 않을 수 있습니다. 몇 가지 예를 살펴보겠습니다.

<u>문제 예</u>

ExampleCo와 같은 두 개의 구성 파일이 디스패처 구성 개발자가 만든 사이트입니다.

`/etc/httpd/conf.d/exampleco.conf`


```
`<` VirtualHost *:80`>` 

    ServerName  "exampleco"

    ServerAlias "www.exampleco.com"

    .......... SNIP ...............

    `<` IfModule mod_rewrite.c`>` 

        ReWriteEngine   on

        LogLevel warn rewrite:trace1

        Include /etc/httpd/conf.d/rewrites/exampleco.conf

    `<` /IfModule`>` 

`<` /VirtualHost`>`
```


`/etc/httpd/conf.d/rewrites/exampleco.conf``>`


```
RewriteRule /$ /content/exampleco/en.html `[` PT,L`]` 

RewriteRule /robots.txt$ /content/dam/exampleco/robots.txt `[` PT,L`]`
```


<b>잠재적 위험</b>

<b>A. 파일 이름이 동일합니다</b>

vhost 파일이 실수로 rewrites 폴더에 들어가고 rewrites 파일이 vhosts 폴더에 저장되는 경우 파일 이름으로 적절히 배포될 것으로 보이지만 Apache에서 오류를 발생하고 문제가 즉시 나타나지 않습니다.

<b>이러한 문제가 일반적으로 문제가 되는 이유는 무엇입니까?</b>

두 파일이 동일한 위치에 다운로드되면 자신을 덮어쓰거나 구분할 수 없게 되어 배포 프로세스가 악몽이 될 수 있습니다.

<b>B. 파일 확장자는 동일하며 자동 포함이 쉽습니다</b>

파일 확장자는 동일하며 Apache가 대부분의 기본 폴더에 .conf 파일을 자동으로 포함하는 자동 포함된 확장자를 사용합니다.

<b>이러한 문제가 일반적으로 문제가 되는 이유는 무엇입니까?</b>

.conf 확장자를 사용하는 vhost 파일이 /etc/httpd/conf.d/ 폴더에 저장되는 경우 일반적으로 양호한 Apache의 메모리에 로드하려고 하지만, .conf 확장자를 사용하는 rewrite 규칙 파일이 `/etc/httpd/conf.d/` 폴더를 사용하면 자동으로 포함되고 전역적으로 적용되므로 혼란스럽고 원치 않는 결과가 발생합니다.


## 해결 방법 {#resolution}


파일의 이름을 파일의 작업에 기반하고 자동 포함 규칙 네임스페이스에서 안전하게 해제하십시오.

- 가상 호스트 파일 이름인 경우 `.vhost` 를 확장 프로그램으로 사용합니다.
- rewrite 규칙 파일인 경우 이름을 &quot;&lt;` site`>` _rewrite.rules` 는 접미사 및 확장명으로 사용됩니다. 이러한 명명 규칙을 사용하면 해당 사이트와 재작성 규칙 세트임을 알 수 있습니다.
- IP 화이트리스트 규칙 파일인 경우 이름을 &quot;&lt;` description`>` _whitelist.rules` 는 접미사 및 확장명으로 사용됩니다. 이 명명 규칙에서는 용도를 설명하고 IP 일치 규칙 세트임을 설명합니다.


이러한 이름 지정 규칙을 사용하면 파일이 속하지 않는 자동 포함 디렉토리로 이동하는 경우 문제가 발생하지 않습니다.

예를 들어 .rules, .any 또는 .vhost를 사용하여 이름이 지정된 파일을 `/etc/httpd/conf.d/` 아무 영향도 없을 거야

배포 변경 요청에 `please deploy exampleco_rewrite.rules to production dispatchers` 변경 사항을 배포하는 사람은 이미 새 사이트를 추가하지 않고 있음을 알 수 있습니다. 이들은 파일 이름에 표시된 대로 rewrite 규칙을 업데이트하고 있습니다.

<b>주문 포함</b>

Enterprise Linux에 설치된 Apache 웹 서버의 기능 및 구성을 확장할 때 몇 가지 중요한 사항이 있습니다 <b>주문 포함</b> 이해하길 원할 거야

A. Apache 기준 포함

![apache 기준 포함 순서.  apache 바이너리는 conf.d/에 대한 includeoptional을 수행하는 httpd.conf로 시작합니다.*.conf 및 conf.modules.d/*.conf 디렉토리](https://helpx.adobe.com/content/dam/kb/en/ams-dispatcher-manual/Apache-Webserver-Baseline-Includes.png "Apache-Webserver-Baseline-Includes")

위의 다이어그램에서 볼 수 있듯이 httpd 바이너리는 구성 파일로서 httpd.conf 파일만 찾습니다. 이 파일에는 다음 문이 포함되어 있습니다.


```
Include conf.modules.d/*.conf

IncludeOptional conf.d/*.conf
```


B. AMS 최상위 수준 포함

표준을 적용할 때 몇 가지 추가 파일 형식과 자체 include를 추가했습니다.

다음은 AMS 기준 디렉토리와 최상위 수준 include입니다.

![AMS 기준 include는 /etc/httpd/conf.d/enabled_vhosts/ 디렉토리에서 *.vhost가 있는 파일을 포함하는 dispatcher_vhost.conf로 시작됩니다.  /etc/httpd/conf.d/enabled_vhosts/ 디렉토리의 항목은 /etc/httpd/conf.d/available_vhosts/에 있는 실제 구성 파일에 대한 symlink입니다.](https://helpx.adobe.com/content/dam/kb/en/ams-dispatcher-manual/Apache-Webserver-AMS-Baseline-Includes.png "Apache-Webserver-AMS-Baseline-Includes")

Apache의 기준을 구축하여 AMS가 어떻게 추가적인 폴더와 최상위 수준 include를 만들었는지를 보여줍니다. `conf.d` 폴더 및 아래에 중첩된 모듈 특정 디렉토리 `/etc/httpd/conf.dispatcher.d/`

Apache가 로드되면 `/etc/httpd/conf.modules.d/02-dispatcher.conf` 그리고 이 파일에는 이진 파일이 포함됩니다 `/etc/httpd/modules/mod_dispatcher.so` 실행 중인 상태로 전환됩니다.


```
LoadModule dispatcher_module modules/mod_dispatcher.so
```


에서 모듈을 사용하려면 `<` VirtualHost /`>`  구성 파일을 `/etc/httpd/conf.d/` 명명된 이름 `dispatcher_vhost.conf` 이 파일 내부에는 모듈이 작동하는 데 필요한 기본 매개 변수 설정 이 표시됩니다.


```
IfModule disp_apache2.c 

DispatcherConfig conf.dispatcher.d /dispatcher .any

...SNIP...

/IfModule
```


위에서 볼 수 있듯이 여기에는 디스패처 모듈에서 구성 파일을 선택하도록 하는 최상위 수준 dispatcher.any 파일이 포함되어 있습니다. `/etc/httpd/conf.dispatcher.d/dispatcher.any`

다음 파일의 내용에 주의하십시오.


```
/farms {

   $include "enabled_farms/*_farm.any"

}
```


최상위 수준 dispatcher.any 파일에는 에 있는 사용 가능한 모든 팜 파일이 포함되어 있습니다 `/etc/httpd/conf.dispatcher.d/enabled_farms/` 파일 이름 &quot;&lt;` FILENAME`>` _farm.any` 표준 명명 규칙을 따릅니다.

나중에 `dispatcher_vhost.conf` 앞서 언급한 파일에서도 사용 가능한 각 가상 호스트 파일이 `/etc/httpd/conf.d/enabled_vhosts/` 다음 파일 이름을 &quot;&lt;` FILENAME`>` .vhost` 표준 명명 규칙을 따릅니다.


```
IncludeOptional /etc/httpd/conf.d/enabled_vhosts/*.vhost
```


각 .vhost 파일에서 디스패처 모듈은 디렉토리의 기본 파일 처리기로 초기화됩니다. 다음은 구문을 보여주는 .vhost 파일의 예입니다.


```
`<` VirtualHost *:80`>` 

    ServerName    "weretail"

    ServerAlias www.weretail.com weretail.com

    `<` Directory /`>` 

        `<` IfModule disp_apache2.c`>` 

            ....SNIP....

            SetHandler dispatcher-handler

        `<` /IfModule`>` 

        ....SNIP....

    `<` /Directory`>` 

    ....SNIP....

`<` /VirtualHost`>`
```


최상위 수준 include가 해결되면 참조할 만한 다른 하위 include가 생깁니다. 다음은 팜 및 vhosts 파일에 다른 하위 요소가 포함되는 방법에 대한 높은 수준의 다이어그램입니다

C. AMS 가상 호스트에 다음이 포함됩니다.

![ams 가상 호스트는 하위 항목을 포함합니다.  이 그림은 하나의 .vhost 파일이 변수, 허용 목록 및 다시 작성 폴더의 파일을 포함하는 방법을 보여줍니다](https://helpx.adobe.com/content/dam/kb/en/ams-dispatcher-manual/Apache-Webserver-AMS-Vhost-Includes.png "Apache-Webserver-AMS-Vhost-Includes")

.vhost 파일이 `/etc/httpd/conf.d/availabled_vhosts/` 디렉토리 `/etc/httpd/conf.d/enabled_vhosts/` 디렉토리 설정은 실행 중인 구성에서 사용됩니다.

.vhost 파일에는 우리가 찾은 공통 부분을 기반으로 하위 include가 있습니다.  변수, 허용 목록 및 재작성 규칙과 같은 것입니다.

.vhost 파일은 .vhost 파일에 포함해야 하는 위치에 따라 각 파일에 대한 include 구문을 갖게 됩니다.  다음은 좋은 참조로서 .vhost 파일의 구문 예입니다.


```
Include /etc/httpd/conf .d /variables/weretail .vars VirtualHost *:80

ServerName    "${MAIN_DOMAIN}" 

Directory /          Include /etc/httpd/conf .d /whitelists/weretail *_whitelist.rules

IfModule disp_apache2.c

....SNIP....

SetHandler dispatcher-handler

/IfModule

....SNIP....

/Directory

....SNIP....

IfModule mod_rewrite.c

ReWriteEngine   on

LogLevel warn rewrite:trace1

Include /etc/httpd/conf .d /rewrites/weretail_rewrite .rules

/IfModule /VirtualHost
```


위의 예에서 볼 수 있듯이 나중에 사용되는 이 구성 파일에 필요한 변수에 대한 include가 있습니다.

파일 내부 `/etc/httpd/conf.d/variables/weretail.vars` 정의된 변수를 확인할 수 있습니다.


```
Define MAIN_DOMAIN dev.weretail.com
```


다른 허용 목록 기준에 따라 이 컨텐츠를 볼 수 있는 사용자를 제한하는 whitelist.rules 파일 목록이 포함된 줄을 볼 수도 있습니다. 흰색 목록 파일 중 하나의 내용을 살펴보겠습니다 `/etc/httpd/conf.d/whitelists/weretail_mainoffice_whitelist.rules`:


```
`<` RequireAny`>` 

  Require ip 192.150.16.0/23

`<` /RequireAny`>`
```


재작성 규칙 세트를 포함하는 줄을 볼 수도 있습니다. 그 내용을 살펴봅시다 `weretail_rewrite.rules` 파일:


```
RewriteRule /robots.txt$ /content/dam/weretail/robots.txt `[` NC,PT`]` 

RewriteCond %{SERVER_NAME} brand1.weretail.net `[` NC`]` 

RewriteRule /favicon.ico$ /content/dam/weretail/favicon.ico `[` NC,PT`]` 

RewriteCond %{SERVER_NAME} brand2.weretail.com `[` NC`]` 

RewriteRule /sitemap.xml$ /content/weretail/general/sitemap.xml `[` NC,PT`]` 

RewriteRule /logo.jpg$ /content/dam/weretail/general/logo.jpg `[` NC,PT`]`
```


D. AMS 팜은 다음을 포함합니다.

![<FILENAME>_farms.any에는 팜 구성을 완료하는 하위 .any 파일이 포함됩니다.  이 그림에서 팜에 각 최상위 수준 섹션 파일 캐시, clientheaders, filters, renders 및 vhosts .any 파일이 포함됩니다.](https://helpx.adobe.com/content/dam/kb/en/ams-dispatcher-manual/Apache-Webserver-AMS.-Farm-Includes.png "Apache-Webserver-AMS-Farm-Include")

&quot;&lt;` FILENAME`>` _farm.any` 파일 `/etc/httpd/conf.dispatcher.d/available_farms/` 디렉토리 `/etc/httpd/conf.dispatcher.d/enabled_farms/` 디렉토리 설정은 실행 중인 구성에서 사용됩니다.

팜 파일은 [팜의 최상위 섹션](https://experienceleague.adobe.com/docs/experience-manager-dispatcher/using/configuring/dispatcher-configuration.html?lang=en#defining-farms-farms) cache, clientheaders, filters, renders 및 vhosts와 같습니다.

다음 ``<` FILENAME`>` _farm.any` files will have include statements for each file based on where they need to be included in the farm file. Here is an example syntax of a ``&lt;` FILENAME`>` _farm.any` 파일 참조:


```
/weretailfarm {  

    /clientheaders {

        $include "/etc/httpd/conf.dispatcher.d/clientheaders/ams_publish_clientheaders.any"

        $include "/etc/httpd/conf.dispatcher.d/clientheaders/ams_common_clientheaders.any"

    }

    /virtualhosts {

        $include "/etc/httpd/conf.dispatcher.d/vhosts/weretail_vhosts.any"

    }

    /renders {

        $include "/etc/httpd/conf.dispatcher.d/renders/ams_publish_renders.any"

    }

    /filter {

        $include "/etc/httpd/conf.dispatcher.d/filters/ams_publish_filters.any"

        $include "/etc/httpd/conf.dispatcher.d/filters/weretail_search_filters.any"

    }

    ....SNIP....

    /cache {

        ....SNIP....

        /rules {

            $include "/etc/httpd/conf.dispatcher.d/cache/ams_publish_cache.any"

        }

        ....SNIP....

        /allowedClients {

            /0000 {

                /glob "*.*.*.*"

                /type "deny"

            }

            $include "/etc/httpd/conf.dispatcher.d/cache/ams_publish_invalidate_allowed.any"

        }

    ....SNIP....

    }

}
```


볼 수 있듯이 필요한 모든 구문을 보유하는 대신 weretail farm의 각 섹션은 include 문을 대신 사용합니다.

각 하위 include가 어떤 모습인지에 대한 아이디어를 얻기 위해 이러한 몇 가지 include의 구문을 살펴보겠습니다 `/etc/httpd/conf.dispatcher.d/vhosts/weretail_publish_vhosts.any`:


```
"brand1.weretail.com"

"brand2.weretail.com"

"www.weretail.comf"
```


볼 수 있듯이 이 팜에서 다른 팜 위에 렌더링해야 하는 도메인 이름에 대한 새 선으로 구분된 목록입니다.

다음으로, `/etc/httpd/conf.dispatcher.d/filters/weretail_search_filters.any`:


```
/400 { /type "allow" /method "GET" /path "/bin/weretail/lists/*" /extension "json" }

/401 { /type "allow" /method "POST" /path "/bin/weretail/search/" /extension "html" }
```

