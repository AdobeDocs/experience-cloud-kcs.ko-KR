---
title: AEM 인덱싱 문제 분석
description: 설명
solution: Experience Manager
product: Experience Manager
applies-to: Experience Manager
keywords: KCS
resolution: Resolution
internal-notes: null
bug: false
article-created-by: Roxann McGlumphy
article-created-date: 10/21/2021 5:47:49 PM
article-published-by: Cedric Latimier
article-published-date: 1/6/2022 9:04:25 AM
version-number: 1
article-number: KA-17492
dynamics-url: https://adobe-ent.crm.dynamics.com/main.aspx?forceUCI=1&pagetype=entityrecord&etn=knowledgearticle&id=846ba2fc-9632-ec11-b6e5-000d3a5ba97a
exl-id: 59a10140-0386-42f8-bd1a-a934a2276ca5
source-git-commit: 1c09d3c2f1f02c0a93586735779e91b9f40a7f7e
workflow-type: tm+mt
source-wordcount: '507'
ht-degree: 0%

---

# AEM 인덱싱 문제 분석

## 설명


이 문서의 목적은 모든 일반적인 색인 문제를 해결하는 방법에 대한 세부 사항을 가지는 것입니다.


## 해상도

<br><br>느린 쿼리 분석<br><br><br><br> <br><br>
이동 [!UICONTROL 도구] - [!UICONTROL 작업] - [!UICONTROL 대시보드] - [!UICONTROL 진단] - [!UICONTROL 쿼리 성능] 은 느린 쿼리 목록을 표시합니다.

자세한 내용은 [이 문서](https://docs.adobe.com/docs/en/aem/6-2/deploy/platform/queries-and-indexing.html#Troubleshooting%20indexing%20issues) 느린 쿼리 분석에 대한 자세한 내용을 보려면

비프로덕션 환경에서 ACS AEM 도구 패키지를 설치하여 추가 디버깅을 위한 설명 쿼리 도구를 제공할 수 있습니다.
<br><br><br><br> <br><br>비동기 인덱스 다시 인덱싱<br><br><br><br><br><br>
참고:

일반적으로 재색인화는 올바른 결과를 반환하지 않는 쿼리와 같은 쿼리 문제를 해결하지 않습니다. 또한 재색인화는 여기에 나열된 이유로 다루지 않는 한 오랜 시간이 걸릴 수 있습니다.
<br><br><br><br> <br><br>
<b>비동기 인덱스를 다시 색인화하는 방법</b>

- AEM 인스턴스에 로그인합니다.
- 열기 `http://aemhost:port/crx/de/index.jsp`
- 아래의 인덱스 정의로 이동합니다. `/oak:index`
- 부울 속성 설정 `reindex=true` 색인화할 색인에서 저장한 다음 저장합니다. 색인이 시작되면 다음과 같은 로그 메시지가 표시됩니다.

```
23.06.2015 14:26:23.070 \*INFO\* FelixStartLevel org.apache.jackrabbit.oak.plugins.index.IndexUpdate Reindexing will be performed for following indexes: /oak:index/cqAcUUID, /oak:index/nodetype, /oak:index/deviceIdentificationMode, /oak:index/campaignpath, /oak:index/active, /oak:index/jcrFrozenMixinTypes
```

- 재색인화가 진행 중인 동안 &#39;`status`&#39; 특성 `IndexStatsMBean` 값은`running`&#39;

```
 23.06.2015 14:26:23.517 \*INFO\* FelixStartLevel org.apache.jackrabbit.oak.plugins.index.IndexUpdate Reindexing Traversed #10000 /jcr:system/jcr:versionStorage/c8/5f...23.06.2015 14:28:51.999 \*INFO\* pool-8-thread-1 org.apache.jackrabbit.oak.plugins.index.IndexUpdate Indexing report    - /oak:index/counter\*(708)    - /oak:index/authorizables\*(159)    - /oak:index/cqPageLucene\*(1913)    - /oak:index/ntBaseLucene\*(444)    - /oak:index/cqTagLucene\*(512)    - /oak:index/workflowDataLucene\*(116)
```

- 인덱스 정의 노드, 속성을 확인하여 색인화가 완료되었는지 확인할 수 있습니다 `reindexCount` 를 증가시키고 재색인 부울을 &quot;(으)로 설정해야 합니다.`false`&quot;

   로그 파일에서 색인이 성공적으로 완료되면 다음 항목이 표시됩니다

```
23.06.2015 14:28:52.009 \*INFO\* pool-8-thread-1 org.apache.jackrabbit.oak.plugins.index.AsyncIndexUpdate Reindexing (async) completed for indexes: /oak:index/counter\*(708), /oak:index/authorizables\*(159), /oak:index/cqPageLucene\*(1913), /oak:index/ntBaseLucene\*(444), /oak:index/cqTagLucene\*(512), /oak:index/workflowDataLucene\*(116) in 30.36 s
```

- 재색인화가 완료되지 않고 루프로 이동한 경우 다음을 확인합니다. [아래 섹션](https://helpx.adobe.com/experience-manager/kb/Analyzing-AEM-Indexing-Issues.html#Analyzing_Failed_Reindexing).


비동기 인덱스 활동은 INFO 수준에서 grep on을 통해 식별할 수 있습니다 `org.apache.jackrabbit.plugins.index.IndexUpdate` 및 `org.apache.jackrabbit.plugins.index.AsyncIndexUpdate`.
 <br><br>비동기 인덱싱 성능 문제<br><br><br><br> 
- 로깅을 사용하여 타이밍을 확인합니다.


TRACE 수준(Oak 1.0.17 이상에서만):

```
org.apache.jackrabbit.oak.plugins.index.lucene.LuceneIndexEditorContext.perf
```

디버그 수준:

```
org.apache.jackrabbit.oak.plugins.index.AsyncIndexUpdate

org.apache.jackrabbit.oak.plugins.index.IndexUpdate

org.apache.jackrabbit.oak.plugins.index.lucene.LuceneIndexEditor

org.apache.jackrabbit.oak.plugins.index.lucene.IndexTracker

org.apache.jackrabbit.oak.plugins.index.lucene.LuceneIndexEditorContext

org.apache.jackrabbit.oak.plugins.index.lucene.IndexCopier
```

다음과 같은 로그가 생성되어 색인의 타이밍이 표시됩니다.

```
09.07.2015 08:13:38.401 \*TRACE\* 192.168.193.1 1436444018387 POST /content/dam/site/test.createasset.html HTTP/1.1 org.apache.jackrabbit.oak.jcr.operations.writes session-101777 Adding node /content/dam/site/test/jackrabbit-oak7.png
09.07.2015 08:13:38.583 \*TRACE\* 192.168.193.1 1436444018387 POST /content/dam/site/test.createasset.html HTTP/1.1 org.apache.jackrabbit.oak.jcr.operations.writes session-101777 save
09.07.2015 08:13:42.823 \*DEBUG\* pool-9-thread-1 org.apache.jackrabbit.oak.plugins.index.AsyncIndexUpdate Running background index task async
09.07.2015 08:13:42.963 \*TRACE\* pool-9-thread-1 org.apache.jackrabbit.oak.plugins.index.lucene.LuceneIndexEditor /oak:index/lucene Indexed document for /content/dam/site/test/jackrabbit-oak7.png/jcr:content/related is Documentstored,indexed,omitNorms,indexOptions=DOCS_ONLY:path:/content/dam/site/test/jackrabbit-oak7.png/jcr:content/related indexed,tokenized:fulltext:related
09.07.2015 08:13:43.579 \*DEBUG\* pool-9-thread-1 org.apache.jackrabbit.oak.plugins.index.IndexUpdate Indexing report
```

- `/oak:index/siteDamIndex(2)`
- `/oak:index/lucene(15)`

```
09.07.2015 08:13:43.779 \*TRACE\* oak-lucene-0 org.apache.jackrabbit.oak.plugins.index.lucene.IndexTracker.perf /oak:index/siteDamIndex Index found to be updated. Reopening the IndexNode took 150ms
09.07.2015 08:13:45.248 \*TRACE\* oak-lucene-0 org.apache.jackrabbit.oak.plugins.index.lucene.IndexCopier.perf /oak:index/lucene Copied 0 files totaling 0 B took 1465ms
09.07.2015 08:13:45.248 \*TRACE\* oak-lucene-0 org.apache.jackrabbit.oak.plugins.index.lucene.IndexCopier /oak:index/lucene opening remote only file segments.gen
09.07.2015 08:13:45.361 \*TRACE\* oak-lucene-0 org.apache.jackrabbit.oak.plugins.index.lucene.IndexTracker.perf /oak:index/lucene Index found to be updated. Reopening the IndexNode took 1581ms
```

- 일련의 스레드 덤프를 가져와서 포함된 스레드를 검색합니다 `AsyncIndexUpdate` 스택에서 대부분의 인덱싱 시간이 사용되는 위치나 다른 일부 스레드에서 색인화가 대기 중인지 확인하십시오. 스레드 덤프를 가져오려면 다음을 참조하십시오. [이 문서](https://helpx.adobe.com/experience-manager/kb/TakeThreadDump.html).
- 부울 속성을 설정합니다 `saveDirectoryListing=true` (Oak 1.0.16을 사용하는 경우에만 해당, 이후 버전이 필요하지 않은 경우) 및 속성 설정 `excludedPaths=/var`, `/etc/workflow/instances`, `/jcr:system` on `/oak:index/lucene` OOTB 인덱스를 사용하여 최적화합니다.
- 모두 저장 을 클릭합니다.
- 사용자 지정 lucene 속성 인덱스를 만들 때 반드시 설정해야 합니다 `saveDirectoryListing=true` Oak 1.0.16을 사용하고 설정된 경우 (부울) `includedPaths` (문자열) 인덱스를 특정 경로만 색인화하도록 제한합니다.


이 URL로 이동 `/system/console/configMgr/org.apache.jackrabbit.oak.plugins.index.lucene.LuceneIndexProviderService` &quot;Copy on Read&quot;, &quot;Copy on Write&quot;(Oak 1.0.18 이상에서 사용할 경우에만 안전함) 및 &quot;Prefetch Index Files&quot;(Oak 1.0.18 이상에서만)
<br><br><br>분석 실패 재인덱싱<br><br><br><br>
- 비동기 색인화가 실패하는 경우 Async Indexer 통계 JMX UI(아래 링크)를 선택하면 다음이 표시됩니다 `LastIndexedTime` 은 이전 날짜 및 시간입니다.

```
http://localhost:4502/system/console/jmx/org.apache.jackrabbit.oak%3Aid%3D11%2Cname%3D"async"%2Ctype%3D"IndexStats"
```

- 또한 재색인화가 실패하면 다음과 같은 루프가 됩니다.

```
08.01.2015 01:22:04.474 \*INFO\* pool-9-thread-2 org.apache.jackrabbit.oak.plugins.index.IndexUpdate Reindexing will be performed for following indexes /oak:index/damFileSize, /oak:index/lucene, /oak:index/cqLastModified08.01.2015 01:52:08.365 \*INFO\* pool-9-thread-5 org.apache.jackrabbit.oak.plugins.index.IndexUpdate Reindexing will be performed for following indexes /oak:index/damFileSize, /oak:index/lucene, /oak:index/cqLastModified08.01.2015 09:33:23.306 \*INFO\* pool-9-thread-5 org.apache.jackrabbit.oak.plugins.index.IndexUpdate Reindexing will be performed for following indexes /oak:index/damFileSize, /oak:index/lucene, /oak:index/cqLastModified
```

- 이 경우 다음에 대한 디버그 수준 로깅을 활성화해야 합니다 `org.apache.jackrabbit.oak.plugins.index`


- 다음에 위에 있는 디버그 로그 메시지 위에 로그 메시지를 사용하여 색인화가 반복되면 색인화가 실패하는 이유에 대한 자세한 정보를 제공합니다.  그런 다음 노드가 손상되었는지, Blob가 누락되었는지 또는 다른 문제가 있는지 여부를 해결할 수 있습니다.
