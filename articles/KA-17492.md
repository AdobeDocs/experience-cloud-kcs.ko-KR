---
title: AEM 인덱싱 문제 분석
description: 설명
solution: Experience Manager
product: Experience Manager
applies-to: Experience Manager
keywords: KCS
resolution: Resolution
internal-notes: null
bug: false
article-created-by: Roxann McGlumphy
article-created-date: 10/21/2021 5:47:49 PM
article-published-by: Cedric Latimier
article-published-date: 1/6/2022 9:04:25 AM
version-number: 1
article-number: KA-17492
dynamics-url: https://adobe-ent.crm.dynamics.com/main.aspx?forceUCI=1&pagetype=entityrecord&etn=knowledgearticle&id=846ba2fc-9632-ec11-b6e5-000d3a5ba97a
exl-id: 59a10140-0386-42f8-bd1a-a934a2276ca5
source-git-commit: 1c09d3c2f1f02c0a93586735779e91b9f40a7f7e
workflow-type: ht
source-wordcount: '507'
ht-degree: 100%

---

# AEM 인덱싱 문제 분석

## 설명


이 문서의 목적은 일반적인 모든 인덱싱 문제를 해결할 수 있는 방법을 구체적으로 제시하기 위함입니다.


## 해상도

<br><br>느린 쿼리 분석<br><br><br><br><br><br>
[!UICONTROL 도구] - [!UICONTROL 작업] - [!UICONTROL 대시보드] - [!UICONTROL Diagnosis] - [!UICONTROL 쿼리 성능]으로 이동하면 느린 쿼리 목록이 표시됩니다.

느린 쿼리 분석에 대한 자세한 내용은 [이 문서](https://docs.adobe.com/docs/en/aem/6-2/deploy/platform/queries-and-indexing.html#Troubleshooting%20indexing%20issues)를 참조하십시오.

비프로덕션 환경에서 ACS AEM 도구 패키지를 설치하여 디버깅 기능을 추가할 수 있는 설명 쿼리 도구를 제공합니다.
<br><br><br><br> <br><br>비동기 인덱스 리인덱싱<br><br><br><br><br><br>
참고:

일반적으로 리인덱싱이 되어도 올바른 결과를 반환하지 않는 쿼리와 같은 쿼리 문제는 해결되지 않습니다. 또한 리인덱싱하는 데 시간이 오래 소요될 수 있고, 아래 나열된 이유에 해당되지 않으면 리인덱싱하는 것을 피하십시오.
<br><br><br><br> <br><br>
<b>비동기 인덱스를 다시 인덱싱하는 방법</b>

- AEM 인스턴스에 로그인
- 열기 `http://aemhost:port/crx/de/index.jsp`
- `/oak:index` 아래의 인덱스 정의로 이동
- 인덱스에서 부울 속성 `reindex=true`를 설정하여 다시 인덱싱한 다음 저장합니다. 인덱싱이 시작되면 다음과 같은 로그 메시지가 나타납니다.

```
23.06.2015 14:26:23.070 \*INFO\* FelixStartLevel org.apache.jackrabbit.oak.plugins.index.IndexUpdate Reindexing will be performed for following indexes: /oak:index/cqAcUUID, /oak:index/nodetype, /oak:index/deviceIdentificationMode, /oak:index/campaignpath, /oak:index/active, /oak:index/jcrFrozenMixinTypes
```

- 리인덱싱이 진행 중이면 `IndexStatsMBean`의 “`status`” 속성에 값 “`running`”이 포함되었을 것입니다.

```
 23.06.2015 14:26:23.517 \*INFO\* FelixStartLevel org.apache.jackrabbit.oak.plugins.index.IndexUpdate Reindexing Traversed #10000 /jcr:system/jcr:versionStorage/c8/5f...23.06.2015 14:28:51.999 \*INFO\* pool-8-thread-1 org.apache.jackrabbit.oak.plugins.index.IndexUpdate Indexing report    - /oak:index/counter\*(708)    - /oak:index/authorizables\*(159)    - /oak:index/cqPageLucene\*(1913)    - /oak:index/ntBaseLucene\*(444)    - /oak:index/cqTagLucene\*(512)    - /oak:index/workflowDataLucene\*(116)
```

- 인덱스 정의 노드 점검을 통해 인덱싱이 완료되었고, 속성 `reindexCount`가 증분되었고, 인덱스 부울이 “`false`”로 설정되었는지 확인할 수 있습니다.

   로그 파일에서, 인덱싱이 성공적으로 완료되면 다음 항목이 표시됩니다.

```
23.06.2015 14:28:52.009 \*INFO\* pool-8-thread-1 org.apache.jackrabbit.oak.plugins.index.AsyncIndexUpdate Reindexing (async) completed for indexes: /oak:index/counter\*(708), /oak:index/authorizables\*(159), /oak:index/cqPageLucene\*(1913), /oak:index/ntBaseLucene\*(444), /oak:index/cqTagLucene\*(512), /oak:index/workflowDataLucene\*(116) in 30.36 s
```

- 리인덱싱이 완료되지 않고 루프로 이동한 경우 [아래 섹션](https://helpx.adobe.com/kr/experience-manager/kb/Analyzing-AEM-Indexing-Issues.html#Analyzing_Failed_Reindexing)을 참조하십시오.


비동기 인덱스 활동은 `org.apache.jackrabbit.plugins.index.IndexUpdate` 및 `org.apache.jackrabbit.plugins.index.AsyncIndexUpdate`의 그레핑을 통해 INFO 수준에서 식별할 수 있습니다.
 <br><br>비동기 인덱싱 성능 문제<br><br><br><br> 
- 로깅을 활성화하여 타이밍 확인:


추적 수준(Oak 1.0.17 이상에서만):

```
org.apache.jackrabbit.oak.plugins.index.lucene.LuceneIndexEditorContext.perf
```

디버그 수준:

```
org.apache.jackrabbit.oak.plugins.index.AsyncIndexUpdate

org.apache.jackrabbit.oak.plugins.index.IndexUpdate

org.apache.jackrabbit.oak.plugins.index.lucene.LuceneIndexEditor

org.apache.jackrabbit.oak.plugins.index.lucene.IndexTracker

org.apache.jackrabbit.oak.plugins.index.lucene.LuceneIndexEditorContext

org.apache.jackrabbit.oak.plugins.index.lucene.IndexCopier
```

인덱싱 타이밍을 보여 주는 다음과 같은 로그가 생성됩니다.

```
09.07.2015 08:13:38.401 \*TRACE\* 192.168.193.1 1436444018387 POST /content/dam/site/test.createasset.html HTTP/1.1 org.apache.jackrabbit.oak.jcr.operations.writes session-101777 Adding node /content/dam/site/test/jackrabbit-oak7.png
09.07.2015 08:13:38.583 \*TRACE\* 192.168.193.1 1436444018387 POST /content/dam/site/test.createasset.html HTTP/1.1 org.apache.jackrabbit.oak.jcr.operations.writes session-101777 save
09.07.2015 08:13:42.823 \*DEBUG\* pool-9-thread-1 org.apache.jackrabbit.oak.plugins.index.AsyncIndexUpdate Running background index task async
09.07.2015 08:13:42.963 \*TRACE\* pool-9-thread-1 org.apache.jackrabbit.oak.plugins.index.lucene.LuceneIndexEditor /oak:index/lucene Indexed document for /content/dam/site/test/jackrabbit-oak7.png/jcr:content/related is Documentstored,indexed,omitNorms,indexOptions=DOCS_ONLY:path:/content/dam/site/test/jackrabbit-oak7.png/jcr:content/related indexed,tokenized:fulltext:related
09.07.2015 08:13:43.579 \*DEBUG\* pool-9-thread-1 org.apache.jackrabbit.oak.plugins.index.IndexUpdate Indexing report
```

- `/oak:index/siteDamIndex(2)`
- `/oak:index/lucene(15)`

```
09.07.2015 08:13:43.779 \*TRACE\* oak-lucene-0 org.apache.jackrabbit.oak.plugins.index.lucene.IndexTracker.perf /oak:index/siteDamIndex Index found to be updated. Reopening the IndexNode took 150ms
09.07.2015 08:13:45.248 \*TRACE\* oak-lucene-0 org.apache.jackrabbit.oak.plugins.index.lucene.IndexCopier.perf /oak:index/lucene Copied 0 files totaling 0 B took 1465ms
09.07.2015 08:13:45.248 \*TRACE\* oak-lucene-0 org.apache.jackrabbit.oak.plugins.index.lucene.IndexCopier /oak:index/lucene opening remote only file segments.gen
09.07.2015 08:13:45.361 \*TRACE\* oak-lucene-0 org.apache.jackrabbit.oak.plugins.index.lucene.IndexTracker.perf /oak:index/lucene Index found to be updated. Reopening the IndexNode took 1581ms
```

- 일련의 스레드 덤프를 가져와 스택의 `AsyncIndexUpdate`이 포함된 스레드를 검색하면 인덱싱 시간 대부분이 사용된 위치를 확인하거나 인덱싱이 다른 스레드에서 대기 중인지 확인할 수 있습니다. 스레드 덤프를 가져오려면 [이 문서](https://helpx.adobe.com/kr/experience-manager/kb/TakeThreadDump.html)를 참조하십시오.
- 부울 속성 `saveDirectoryListing=true`(Oak 1.0.16을 사용하는 경우에만, 이후 버전이 필요하지 않은 경우에)를 설정한 다음 `/oak:index/lucene` OOTB 인덱스에서 속성 `excludedPaths=/var`, `/etc/workflow/instances`, `/jcr:system`을 설정하여 최적화할 수 있습니다.
- “모두 저장” 클릭
- 사용자 정의 Lucene 속성 인덱스 생성 시 Oak 1.0.16을 사용하는 경우 `saveDirectoryListing=true`(부울)을 설정한 다음 `includedPaths`(문자열) 속성을 설정하여 특정 경로만 인덱싱하도록 인덱스를 제한해야 합니다.


이 URL `/system/console/configMgr/org.apache.jackrabbit.oak.plugins.index.lucene.LuceneIndexProviderService` “Copy on Read”, “Copy on Write”(Oak 1.0.18 이상에서만 안전하게 사용) 및 “Prefetch Index Files”(Oak 1.0.18 이상에서만 사용)로 이동
<br><br><br>실패한 리인덱싱 분석<br><br><br><br>
- 비동기 인덱싱이 실패하고 비동기 인덱서 통계 JMX UI(아래 링크)를 확인하는 경우 `LastIndexedTime`이 이전 날짜 및 시간이라고 표시됩니다.

```
http://localhost:4502/system/console/jmx/org.apache.jackrabbit.oak%3Aid%3D11%2Cname%3D"async"%2Ctype%3D"IndexStats"
```

- 또한 리인덱싱이 실패하면 다음과 같은 루프로 이동합니다.

```
08.01.2015 01:22:04.474 \*INFO\* pool-9-thread-2 org.apache.jackrabbit.oak.plugins.index.IndexUpdate Reindexing will be performed for following indexes /oak:index/damFileSize, /oak:index/lucene, /oak:index/cqLastModified08.01.2015 01:52:08.365 \*INFO\* pool-9-thread-5 org.apache.jackrabbit.oak.plugins.index.IndexUpdate Reindexing will be performed for following indexes /oak:index/damFileSize, /oak:index/lucene, /oak:index/cqLastModified08.01.2015 09:33:23.306 \*INFO\* pool-9-thread-5 org.apache.jackrabbit.oak.plugins.index.IndexUpdate Reindexing will be performed for following indexes /oak:index/damFileSize, /oak:index/lucene, /oak:index/cqLastModified
```

- 이 경우 `org.apache.jackrabbit.oak.plugins.index`에 대해 디버그 수준 로깅을 활성화해야 합니다.


- 다음에 인덱싱이 디버그 로그 메시지 위의 로그 메시지와 함께 반복되면 인덱싱이 실패한 이유에 대해 구체적으로 설명합니다.  그런 다음 손상된 노드, 누락된 Blob 또는 기타 문제 여부에 관계없이 문제를 해결할 수 있습니다.
