---
title: "오류: 열려 있는 파일이 너무 많습니다."
description: 설명
solution: Experience Manager
product: Experience Manager
applies-to: "Experience Manager"
keywords: "KCS"
resolution: Resolution
internal-notes: null
bug: false
article-created-by: Roxann McGlumphy
article-created-date: "10/20/2021 11:05:19 PM"
article-published-by: Roxann McGlumphy
article-published-date: "10/20/2021 11:10:07 PM"
version-number: 1
article-number: KA-17470
dynamics-url: "https://adobe-ent.crm.dynamics.com/main.aspx?forceUCI=1&pagetype=entityrecord&etn=knowledgearticle&id=dc40aa30-fa31-ec11-b6e5-000d3a5ba97a"
exl-id: 534227cf-df15-4255-b699-e26953bf90e6
source-git-commit: 0c3e421beca46d9fe1952b1f98538a50697216a0
workflow-type: tm+mt
source-wordcount: '641'
ht-degree: 1%

---

# 오류: 열려 있는 파일이 너무 많습니다.

## 설명

<br><br><br>문제<br><br><br><br><br><br>
로그 파일에 &quot;파일이 너무 많습니다.&quot;라는 오류가 있으며 AEM이 응답하지 않습니다.
<br><br><br><br><br><br>원인<br><br><br><br><br><br>
원인은 두 가지 가능성 중 하나입니다.

- 응용 프로그램에서 파일 또는 소켓과 같은 리소스를 사용한 후에 닫지 않습니다.
- 또는 프로세스에서 허용하는 것보다 더 많은 열린 파일이 응용 프로그램에 필요합니다.



## 해상도

<br><br> <br><br><br><br><br><br>
이 문제의 해결 방법은 다음과 같습니다.

1. 열린 파일 제한에 도달하는 원인이 무엇인지 확인하십시오
2. 제한을 늘리거나 애플리케이션 버그를 수정합니다.

<br><br><br><br>열려 있는 파일 또는 소켓 찾기<br><br> <br><br>
\*\* 열린 파일 제한은 파일뿐만 아니라 결합된 총 열린 파일, 파이프 및 소켓에 적용됩니다.

설정 [!DNL Linux] 플랫폼, `lsof` 명령을 사용하여 프로세스에 의해 열려 있는 리소스를 디버깅할 수 있습니다.

다음은 유용한 데이터를 수집할 샘플 스크립트입니다 `lsof` 출력:
<br><br><br><br><br> <br><br><br><br>

```
#!/bin/bash` `if` `$` `# -eq 0` `  ` `then` `    ` `echo` `"No PID specified"` `    ` `echo` `"Run command with PID, for example:"` `    ` `echo` `"lsof-script.sh 12345"` `    ` `exit` `2` `fi`<br>   <br>  `JAVA_PROCESS_PID=$1`<br>   <br>  `lsof` `-p $JAVA_PROCESS_PID` `lsof` `-output-$JAVA_PROCESS_PID.txt`<br>   <br>  `echo` `"Files open by the process:"` `cat` `lsof` `-output-$JAVA_PROCESS_PID.txt | ` `wc` `-l`<br>   <br>  `echo` `"Generated output file with counts of grouped open files lsof-sorted-counts-$JAVA_PROCESS_PID.txt"` `cat` `lsof` `-output-$JAVA_PROCESS_PID.txt |` `awk` `'{print $9}'` `|` `sed` `-e` `"s/\(.*\)\(segmentstore\).*$/\1\2/"` `| ` `sed` `-e` `"s/\(.*\)\(repository/index\).*$/\1\2/"` `|` `sed` `-e` `"s/\(.*\)\(felix/bundle\).*$/\1\2/"` `| ` `sed` `-e` `"s/\(.*\)\(/lib\).*$/\1\2/"` `| ` `sed` `-e` `"s/\(.*\)\(/logs\).*$/\1\2/"` `| ` `sed` `-e` `"s/\(.*\)\(/ext\).*$/\1\2/"` `|` `sort` `|` `uniq` `-c |` `sort` `-rn -k1` `lsof` `-sorted-counts-$JAVA_PROCESS_PID.txt`<br>   <br>  `echo` `"Total open files in OS:"` `lsof` `|` `wc` `-l` 
```


<br><br><br><br><br> <br><br>
샘플 출력:
<br><br><br><br><br> <br><br><br><br>

```
 $ ./lsof-script.sh 18070 Files open by the process:      1995 Generated output file with counts of grouped open files: lsof-sorted-counts-18070.txt Total open files in OS:     18399 
```

<br><br><br><br><br> <br><br>
Inspect 생성된 의 출력 `lsof-sorted-counts-\*.txt` 파일.  프로세스에 의해 현재 열려 있는 파일 또는 소켓이 표시됩니다.

열려 있는 소켓이나 목록에 있는 파일이 열려 있지 않은 경우 응용 프로그램 버그로 인한 것일 수 있습니다.  응용 프로그램 코드를 업데이트하여 파일 및 소켓을 사용한 후 닫습니다.

열려 있는 소켓의 일반적인 원인은 웹 서비스를 제공하는 사용자 지정 코드입니다.  대부분의 경우 라이브러리는 다음과 같습니다 [!DNL Apache] [!DNL Commons HttpClient] 가 사용되지만 개발자가 연결을 닫지 않습니다.  자세한 내용은 [이 문서](https://stackoverflow.com/questions/43454514/proper-usage-of-apache-httpclient-and-when-to-close-it) 자세한 내용 [!DNL Apache] [!DNL Commons HttpClient].
<br><br><br><br> <br><br>셸 세션의 제한 증가<br><br><br><br> <br><br>
최대 열린 파일에 대한 사용자의 제한을 확인한 다음 AEM 프로세스가 실행되는 사용자와 동일한 사용자로 다음을 실행합니다.

`ulimit -Sn ulimit -Hn`

AEM/CQ의 기본 시작 스크립트를 사용할 때 제한을 늘리려면 다음을 수행하십시오.

1. 편집을 위해 `crx-quickstart/bin/start`를 엽니다
2. 변수 추가 `CQ_MAX_OPEN_FILES` 스크립트 맨 위에    `CQ_MAX_OPEN_FILES=8192 export CQ_MAX_OPEN_FILES`


오류가 표시되면 `-bash: ulimit: open files: cannot modify limit: Operation not permitted` AEM을 시작할 때 위의 구성이 작동하지 않습니다.

대신, 제한 시간을 늘려야 합니다 `/etc/security/limits.conf`. 사용자 제한을 다시 구성하는 방법에 대한 자세한 내용은 아래를 참조하십시오.

다음과 같은 타사 애플리케이션 서버를 사용하는 경우 [!DNL JBoss] 또는 [!DNL Websphere]를 클릭하고 아래 섹션을 따라 공급업체 설명서로 확인합니다.

참고:

이 문서의 구성 중 어느 것으로도 문제를 해결하지 못하면 명령을 사용하여 어떤 파일이 열려 있는지 확인하십시오 `lsof -p`. (`-p` 문제 프로세스의 프로세스 id입니다.) 애플리케이션이 파일 핸들을 열어 두고 있을 수 있습니다. 애플리케이션이 아니라 AEM에서 핸들을 잡고 있는 것이 보이면 지원 팀에 문의하십시오.


<br><br><br><br> <br><br>사용자의 제한 증가<br><br><br><br> <br><br>
루트가 아닌 사용자의 최대 열린 파일 수를 변경하려면 파일을 변경합니다 `/etc/security/limits.conf`. 사용자별로 제한을 설정할 수 있습니다.

`crx_process_username soft nofile 8092`

`crx_process_username hard nofile 20000`

참고:

이 구성은 사용자가 다음에 로그인할 때까지 적용되지 않습니다.


<br><br><br><br> <br><br>시스템 제한 증가<br><br><br><br> <br><br>
경우에 따라 사용자 제한이 충분하지만 시스템 자체가 최대 파일 수에 도달하는 경우가 있습니다. 다음 방법으로 실행 `su/root` 사용자:

1. 운영 체제에서 최대 열기 파일 설정을 확인합니다(20000보다 낮으면 이 설정을 늘리는 것이 적절함).    `cat /proc/sys/fs/file-max`
2. 다음 줄에 추가 `/etc/sysctl.conf` 시스템 열기 파일 최대값을 늘리려면 다음을 수행합니다.    `fs.file-max = 300000`
3. 다음 명령을 실행합니다.    `sysctl -p`
4. 이 명령을 실행할 때 새 값이 표시되는지 확인합니다.    `cat /proc/sys/fs/file-max`


참고:

이 구성은 사용자가 다음에 로그인할 때까지 적용되지 않습니다.


<br><br><br><br> <br><br>추가 정보<br><br><br><br> <br><br>
이 오류는 시스템 또는 사용자가 최대 파일 핸들을 사용하는 경우에 발생합니다.

다운로드
[파일 가져오기](https://helpx.adobe.com/content/dam/help/en/experience-manager/kb/TooManyOpenFiles/jcr:content/main-pars/kb_download/check_open_files.sh "check_open_files.sh") <br><br>열린 파일 사용을 모니터링하는 데 사용할 수 있는 셸 스크립트. 최대 수를 늘린 후에도 &quot;열려 있는 파일이 너무 많습니다.&quot; 오류가 지속되는 경우에만 이 스크립트를 사용하십시오. 또는 CRX 또는 애플리케이션이 파일 핸들을 열어 두고 있다고 의심되는 경우 사용할 수 있습니다. 스크립트를 사용하기 전에 다음 변수를 구성합니다. `JAVA_HOME`, `QUICKSTART_PATH`, `OUTPUT_DIR`, `USER`, `MAX_FILES_THRESHOLD`. 스크립트를 사용하려면 해당 스크립트를 크론 작업으로 구성합니다.
