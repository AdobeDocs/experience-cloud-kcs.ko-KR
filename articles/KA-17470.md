---
title: '“오류: 열려 있는 파일이 너무 많습니다”'
description: 설명
solution: Experience Manager
product: Experience Manager
applies-to: "Experience Manager"
keywords: “KCS”
resolution: Resolution
internal-notes: null
bug: false
article-created-by: Roxann McGlumphy
article-created-date: "10/20/2021 11:05:19 PM"
article-published-by: Roxann McGlumphy
article-published-date: "10/20/2021 11:10:07 PM"
version-number: 1
article-number: KA-17470
dynamics-url: "https://adobe-ent.crm.dynamics.com/main.aspx?forceUCI=1&pagetype=entityrecord&etn=knowledgearticle&id=dc40aa30-fa31-ec11-b6e5-000d3a5ba97a"
exl-id: 534227cf-df15-4255-b699-e26953bf90e6
source-git-commit: 0c3e421beca46d9fe1952b1f98538a50697216a0
workflow-type: tm+mt
source-wordcount: '641'
ht-degree: 100%

---

# 오류: 열려 있는 파일이 너무 많습니다

## 설명

<br><br><br>문제<br><br><br><br><br><br>
로그 파일에 “파일이 너무 많습니다”라는 오류가 포함되어 있으며 AEM이 응답하지 않습니다.
<br><br><br><br><br><br>원인<br><br><br><br><br><br>
원인은 다음 두 가지 가능성 중 하나입니다.

- 애플리케이션은 파일이나 소켓과 같은 리소스를 사용하고 닫지 않습니다.
- 아니면 프로세스에 비해 애플리케이션에는 더 많은 열린 파일이 필요합니다.



## 해상도

<br><br> <br><br><br><br><br><br>
이 문제에 대한 해결 방법은 다음과 같습니다.

1. 열린 파일 한도에 도달하게 하는 원인이 무엇인지 알아봅니다.
2. 한도를 늘리거나 애플리케이션 버그를 수정합니다.

<br><br><br><br>열려 있는 파일 또는 소켓 찾기<br><br> <br><br>
\*\* 열린 파일 한도는 파일 뿐만 아니라 결합된 전체 열린 파일, 파이프 및 소켓에 적용됩니다.

[!DNL Linux]플랫폼에서 `lsof` 명령을 사용하여 프로세스로 인해 열린 리소스를 디버깅할 수 있습니다.

다음은 유용한 `lsof` 출력을 수집하는 샘플 스크립트입니다.
<br><br><br><br><br> <br><br><br><br>

```
#!/bin/bash` `if` `$` `# -eq 0` `  ` `then` `    ` `echo` `"No PID specified"` `    ` `echo` `"Run command with PID, for example:"` `    ` `echo` `"lsof-script.sh 12345"` `    ` `exit` `2` `fi`<br>   <br>  `JAVA_PROCESS_PID=$1`<br>   <br>  `lsof` `-p $JAVA_PROCESS_PID` `lsof` `-output-$JAVA_PROCESS_PID.txt`<br>   <br>  `echo` `"Files open by the process:"` `cat` `lsof` `-output-$JAVA_PROCESS_PID.txt | ` `wc` `-l`<br>   <br>  `echo` `"Generated output file with counts of grouped open files lsof-sorted-counts-$JAVA_PROCESS_PID.txt"` `cat` `lsof` `-output-$JAVA_PROCESS_PID.txt |` `awk` `'{print $9}'` `|` `sed` `-e` `"s/\(.*\)\(segmentstore\).*$/\1\2/"` `| ` `sed` `-e` `"s/\(.*\)\(repository/index\).*$/\1\2/"` `|` `sed` `-e` `"s/\(.*\)\(felix/bundle\).*$/\1\2/"` `| ` `sed` `-e` `"s/\(.*\)\(/lib\).*$/\1\2/"` `| ` `sed` `-e` `"s/\(.*\)\(/logs\).*$/\1\2/"` `| ` `sed` `-e` `"s/\(.*\)\(/ext\).*$/\1\2/"` `|` `sort` `|` `uniq` `-c |` `sort` `-rn -k1` `lsof` `-sorted-counts-$JAVA_PROCESS_PID.txt`<br>   <br>  `echo` `"Total open files in OS:"` `lsof` `|` `wc` `-l` 
```


<br><br><br><br><br> <br><br>
샘플 출력:
<br><br><br><br><br> <br><br><br><br>

```
 $ ./lsof-script.sh 18070 Files open by the process:      1995 Generated output file with counts of grouped open files: lsof-sorted-counts-18070.txt Total open files in OS:     18399 
```

<br><br><br><br><br> <br><br>
생성된 `lsof-sorted-counts-\*.txt` 파일의 출력을 검사합니다.  현재 프로세스로 인해 열린 파일 또는 소켓이 표시됩니다.

아직 열리면 안 되는 소켓 또는 파일이 열려 있으면 애플리케이션 버그일 가능성이 높습니다.  파일과 소켓을 사용한 후 애플리케이션 코드를 업데이트하여 닫습니다.

열린 소켓 속도가 느린 원인은 웹 서비스를 만드는 사용자 정의 코드 때문입니다.  대부분의 경우 [!DNL Apache] [!DNL Commons HttpClient]와 같은 라이브러리가 사용되지만 연결이 개발자에 의해 닫히지 않습니다.  [!DNL Apache] [!DNL Commons HttpClient]에 대한 자세한 내용은 [이 문서](https://stackoverflow.com/questions/43454514/proper-usage-of-apache-httpclient-and-when-to-close-it)를 참조하십시오.
<br><br><br><br> <br><br>셸 세션의 제한 늘이기<br><br><br><br> <br><br>
최대 열린 파일의 사용자 제한을 확인한 다음 AEM 프로세스가 실행하는 동일한 사용자로 다음을 실행합니다.

`ulimit -Sn ulimit -Hn`

AEM/CQ의 기본 시작 스크립트를 사용하는 경우 다음 작업을 수행하여 제한을 늘리십시오.

1. 편집을 위해 `crx-quickstart/bin/start`를 엽니다
2. 스크립트 상단에 변수 `CQ_MAX_OPEN_FILES` 추가:    `CQ_MAX_OPEN_FILES=8192 export CQ_MAX_OPEN_FILES`


AEM 시작 시 오류 `-bash: ulimit: open files: cannot modify limit: Operation not permitted`가 표시되면 위의 구성이 작동하지 않습니다

대신 `/etc/security/limits.conf`에서 제한을 늘어야 합니다. 사용자 제한을 재구성하는 방법에 대한 자세한 내용은 아래를 참조하십시오.

[!DNL JBoss] 또는 [!DNL Websphere]와 같은 서드파티 애플리케이션 서버를 사용하는 경우 아래 섹션에 따라 공급업체의 설명서를 확인합니다.

참고:

이 문서의 어떤 구성으로도 문제를 해결할 수 없는 경우 명령 `lsof -p`을 사용하여 열려 있는 파일을 확인합니다. (`-p`는 문제가 있는 프로세스의 프로세스 ID입니다.) 애플리케이션이 파일 핸들을 열린 상태로 둘 수 있습니다. 핸들이 애플리케이션이 아니라 주로 AEM에 의해 유지되는 경우 지원 센터에 문의하십시오.


<br><br><br><br> <br><br>사용자 제한 늘이기<br><br><br><br> <br><br>
루트 사용자가 아닌 경우 최대 열린 파일 수를 변경하려면 파일 `/etc/security/limits.conf`를 변경합니다. 사용자별로 다음 제한을 설정할 수 있습니다.

`crx_process_username soft nofile 8092`

`crx_process_username hard nofile 20000`

참고:

이 구성은 다음에 사용자가 로그인할 때까지 적용되지 않습니다.


<br><br><br><br> <br><br>시스템 제한 늘이기<br><br><br><br> <br><br>
때로는 사용자 제한이 상당히 높지만 시스템 자체가 최대 파일 수에 도달합니다. `su/root` 사용자로 다음을 실행합니다.

1. 운영 체제에서 최대 파일 열기 설정을 확인합니다(20,000 미만인 경우 이 설정을 높이는 것이 좋음).    `cat /proc/sys/fs/file-max`
2. 이 줄을 `/etc/sysctl.conf`에 추가하여 시스템 열기 파일 최대값을 늘입니다.    `fs.file-max = 300000`
3. 이 명령 실행:    `sysctl -p`
4. 이 명령을 실행할 때 새 값이 표시되는지 확인합니다.    `cat /proc/sys/fs/file-max`


참고:

이 구성은 다음에 사용자가 로그인할 때까지 적용되지 않습니다.


<br><br><br><br> <br><br>추가 정보<br><br><br><br> <br><br>
이 오류는 시스템 또는 사용자가 최대 수의 파일 핸들을 사용할 때 발생합니다.

다운로드
[파일 가져오기](https://helpx.adobe.com/content/dam/help/en/experience-manager/kb/TooManyOpenFiles/jcr:content/main-pars/kb_download/check_open_files.sh "check_open_files.sh") <br><br>열린 파일 사용량을 모니터링하는 데 사용할 수 있는 셸 스크립트. 최대값을 늘린 후에도 “파일이 너무 많이 열려 있습니다” 오류가 지속되는 경우에만 이 스크립트를 사용합니다. 또는 CRX 또는 애플리케이션이 파일 핸들을 열린 상태로 둔 것으로 의심되는 경우 사용할 수 있습니다. 스크립트를 사용하기 전에 다음 변수를 구성합니다. `JAVA_HOME`, `QUICKSTART_PATH`, `OUTPUT_DIR`, `USER`, `MAX_FILES_THRESHOLD`. 스크립트를 사용하려면 cron job으로 구성합니다.
