---
title: "오류: 열려 있는 파일이 너무 많습니다. | AEM"
description: 설명
solution: Experience Manager
product: Experience Manager
applies-to: "Experience Manager"
keywords: "KCS, AEM 오류, 너무 많은 파일"
resolution: Resolution
internal-notes: null
bug: false
article-created-by: Nayanika Chakravarty
article-created-date: "5/11/2023 8:07:37 PM"
article-published-by: Nayanika Chakravarty
article-published-date: "5/11/2023 8:10:42 PM"
version-number: 6
article-number: KA-17470
dynamics-url: "https://adobe-ent.crm.dynamics.com/main.aspx?forceUCI=1&pagetype=entityrecord&etn=knowledgearticle&id=4792ab77-37f0-ed11-8849-6045bd006239"
source-git-commit: 1d90c01081b80f8e2c8b5c605cb3eda260c96cc9
workflow-type: tm+mt
source-wordcount: '676'
ht-degree: 46%

---

# 오류: 열려 있는 파일이 너무 많습니다. | AEM

## 설명 {#description}

<b>환경</b>
Adobe Experience Manager


<b>문제/증상</b>
로그 파일에 &#39; 오류가 있습니다.*파일이 너무 많습니다.&#39;* 그리고 Adobe Experience Manager(AEM)은 응답하지 않습니다.




## 해결 방법 {#resolution}


이 문제의 해결 방법은 다음과 같습니다.

1. 열린 파일 한도에 도달하게 하는 원인이 무엇인지 알아봅니다.
2. 한도를 늘리거나 애플리케이션 버그를 수정합니다.


<b>A. 열려 있는 파일 또는 소켓을 찾습니다.</b>

참고 - 열린 파일 제한은 파일뿐만 아니라 결합된 총 열린 파일, 파이프 및 소켓에 적용됩니다.

Linux 플랫폼에서 <b>열린 파일 목록</b> (`lsof`) 명령을 사용하여 프로세스에 의해 열려 있는 리소스를 디버깅할 수 있습니다.

다음은 유용한 데이터를 수집할 샘플 스크립트입니다 `lsof` 출력:


```
#!/bin/bash
if `[`  $# -eq 0 `]` 
  then
    echo "No PID specified"
    echo "Run command with PID, for example:"
    echo "lsof-script.sh 12345"
    exit 2
fi
 
JAVA_PROCESS_PID=$1
 
lsof -p $JAVA_PROCESS_PID `>`  lsof-output-$JAVA_PROCESS_PID.txt
 
echo "Files open by the process:"
cat lsof-output-$JAVA_PROCESS_PID.txt |  wc -l
 
echo "Generated output file with counts of grouped open files lsof-sorted-counts-$JAVA_PROCESS_PID.txt"
cat lsof-output-$JAVA_PROCESS_PID.txt | awk '{print $9}' | sed -e "s/\(.*\)\(segmentstore\).*$/\1\2/" |  sed -e "s/\(.*\)\(repository`[` /`]` index\).*$/\1\2/" | sed -e "s/\(.*\)\(felix`[` /`]` bundle\).*$/\1\2/" |  sed -e "s/\(.*\)\(`[` /`]` lib\).*$/\1\2/" |  sed -e "s/\(.*\)\(`[` /`]` logs\).*$/\1\2/" |  sed -e "s/\(.*\)\(`[` /`]` ext\).*$/\1\2/" | sort | uniq -c | sort -rn -k1 `>`  lsof-sorted-counts-$JAVA_PROCESS_PID.txt
 
echo "Total open files in OS:"
lsof | wc -l
```


<u>샘플 출력</u>:


```
$`>`  ./lsof-script.sh 18070
Files open by the process:
    1995
Generated output file with counts of grouped open files: lsof-sorted-counts-18070.txt
Total open files in OS:
   18399
```


생성된 `lsof-sorted-counts-*.txt` 파일의 출력을 검사합니다.  현재 프로세스로 인해 열린 파일 또는 소켓이 표시됩니다.

열려 있거나 열려 있지 않아야 하는 파일이 있는 경우 응용 프로그램 버그로 인해 발생할 수 있습니다. 파일과 소켓을 사용한 후 애플리케이션 코드를 업데이트하여 닫습니다.

열린 소켓 속도가 느린 원인은 웹 서비스를 만드는 사용자 정의 코드 때문입니다. 대부분의 경우 Apache Commons와 같은 라이브러리 `HttpClient` 은 사용되지만 개발자가 연결을 닫을 수 없습니다. 자세한 내용은 [이 문서](https://stackoverflow.com/questions/43454514/proper-usage-of-apache-httpclient-and-when-to-close-it) apache Commons에 대한 자세한 내용 `HttpClient`.

<b>B. 셸 세션의 제한 증가</b>

최대 열린 파일에 대한 사용자의 제한을 확인한 다음 AEM 프로세스가 실행되는 사용자와 동일한 사용자로 다음을 실행합니다.

`ulimit -Sn ulimit -Hn`

AEM/CQ의 기본 시작 스크립트를 사용하는 경우 다음 작업을 수행하여 제한을 늘리십시오.

1. 편집을 위해 `crx-quickstart/bin/start`를 엽니다
2. 스크립트 상단에 변수 `CQ_MAX_OPEN_FILES` 추가:    `CQ_MAX_OPEN_FILES=8192 export CQ_MAX_OPEN_FILES`


AEM 시작 시 오류 `-bash: ulimit: open files: cannot modify limit: Operation not permitted`가 표시되면 위의 구성이 작동하지 않습니다

대신 `/etc/security/limits.conf`에서 제한을 늘어야 합니다. 사용자 제한을 재구성하는 방법에 대한 자세한 내용은 아래를 참조하십시오.

JBoss 또는 Websphere와 같은 타사 애플리케이션 서버를 사용하는 경우 아래 섹션을 따라 공급업체 설명서로 확인합니다.

참고: 이 문서의 구성 중 어느 것으로도 문제를 해결하지 못하면 명령을 사용하여 어떤 파일이 열려 있는지 확인하십시오 `lsof -p` (-p는 문제 프로세스의 프로세스 id입니다.) 애플리케이션이 파일 핸들을 열린 상태로 둘 수 있습니다. 핸들이 애플리케이션이 아니라 주로 AEM에 의해 유지되는 경우 지원 센터에 문의하십시오.

<b>C. 사용자 제한 증가</b>

루트가 아닌 사용자의 최대 열린 파일 수를 변경하려면 `file/etc/security/limits.conf`. 사용자별로 다음 제한을 설정할 수 있습니다.

`crx_process_username soft nofile 8092`

`crx_process_username hard nofile 20000`

참고: 이 구성은 다음에 사용자가 로그인할 때까지 적용되지 않습니다.

<b>D. 시스템 제한 증가</b>

경우에 따라 사용자 제한이 충분하지만 시스템 자체가 최대 파일 수에 도달하는 경우가 있습니다. 다음 코드를 su/root 사용자로 실행합니다.

1. 운영 체제에서 최대 파일 열기 설정을 확인합니다(20,000 미만인 경우 이 설정을 높이는 것이 좋음).
   `cat /proc/sys/fs/file-max`
2. 다음 줄을 /etc/sysctl.conf에 추가하여 시스템 열기 파일 최대값을 늘립니다.
   `fs.file-max = 300000`
3. 이 명령 실행:
   `sysctl -p`
4. 이 명령을 실행할 때 새 값이 표시되는지 확인합니다.    
   `cat /proc/sys/fs/file-max`


참고: 이 구성은 사용자가 다음에 로그인할 때까지 적용되지 않습니다.

<b>원인</b>

원인은 두 가지 가능성 중 하나입니다.

- 애플리케이션은 파일이나 소켓과 같은 리소스를 사용하고 닫지 않습니다.
- 아니면 프로세스에 비해 애플리케이션에는 더 많은 열린 파일이 필요합니다.


<b>추가 정보</b>

이 오류는 시스템 또는 사용자가 최대 파일 핸들을 사용하는 경우에 발생합니다.

다운로드:

[파일 가져오기](https://helpx.adobe.com/content/dam/help/en/experience-manager/kb/CQ55MonitoringTooManyOpenFiles/jcr_content/main-pars/download-section/download-1/disable-monitoring-scripts-1.0.zip "check_open_files.sh")

열린 파일 사용을 모니터링하는 데 사용할 수 있는 셸 스크립트. 최대값을 늘린 후에도 “파일이 너무 많이 열려 있습니다” 오류가 지속되는 경우에만 이 스크립트를 사용합니다. 또는 CRX 또는 애플리케이션이 파일 핸들을 열린 상태로 둔 것으로 의심되는 경우 사용할 수 있습니다. 스크립트를 사용하기 전에 다음 변수를 구성합니다. `JAVA_HOME`, `QUICKSTART_PATH`, `OUTPUT_DIR`, `USER`, `MAX_FILES_THRESHOLD`. 스크립트를 사용하려면 cron job으로 구성합니다.
