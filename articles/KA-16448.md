---
title: AEM 인스턴스 간에 사용자, 그룹 및 ACL 마이그레이션
description: 설명
solution: Experience Manager
product: Experience Manager
applies-to: Experience Manager
keywords: KCS
resolution: Resolution
internal-notes: 'Helpx Link: https://helpx.adobe.com/experience-manager/kb/migrate-users-groups-ACLs.html ; Contains Docs links that may need to be changed'
bug: false
article-created-by: Gucci Paull
article-created-date: 6/21/2022 6:07:06 PM
article-published-by: Gucci Paull
article-published-date: 6/21/2022 6:07:59 PM
version-number: 8
article-number: KA-16448
dynamics-url: https://adobe-ent.crm.dynamics.com/main.aspx?forceUCI=1&pagetype=entityrecord&etn=knowledgearticle&id=d7ce3bf2-8cf1-ec11-bb3d-6045bd015716
exl-id: 5c285ad4-da35-4ee4-b3d1-3ac9eea5f5b2
source-git-commit: 0f546139887bd42346c58b8aa0ef76015688601c
workflow-type: ht
source-wordcount: '960'
ht-degree: 100%

---

# AEM 인스턴스 간에 사용자, 그룹 및 ACL 마이그레이션

## 설명

ACL 권한을 가진 사용자와 그룹을 AEM에서 한 서버에서 다른 서버로 또는 한 AEM 인스턴스에서 다른 인스턴스로 마이그레이션하는 방법.

## 해상도

**1단계: 관리자 및 익명 사용자 찾기**

1. CRXDE 라이트 앱 `/crx/de/index.jsp`로 이동한 다음 (소스 시스템에서) 관리자로 로그인합니다.
1. “도구” = “쿼리”로 이동합니다.
1. 하단 “쿼리” 상자에 이 쿼리를 입력하여 관리자를 찾습니다. *`/jcr:root/home/users//element(\*,rep:User)@rep:principalName="admin" .`*
1. “실행”을 클릭하고 결과에 있는 관리자 노드의 경로를 텍스트 파일에 복사합니다.
1. 익명 사용자의 경우 쿼리로 3단계를 반복합니다. *`/jcr:root/home/users//element(\*,rep:User)@rep:principalName="anonymous" .`*
1. “실행”을 클릭하고 결과에 있는 익명 사용자 노드의 경로를 텍스트 파일에 복사합니다(이제 “admin”에 대한 경로와 “anonymous”에 대한 경로 등 두 가지 경로가 있음).

   예:

   `/home/users/Q/QY5FIMXeQIbGpwZtQ3Dv` – 소스 시스템의 관리자

   `/home/users/K/Kj1406Qo9IDODc_nk5Ib` – 소스 시스템의 익명 사용자

**2단계 A: 사용자 및 그룹 마이그레이션 (`crx2oak` 또는`oak-upgrade` 사용)**

[crx2oak](https://helpx.adobe.com/kr/experience-manager/6-4/sites/deploying/using/using-crx2oak.html) or [oak-upgrade](https://jackrabbit.apache.org/oak/docs/migration.html) 도구를 사용하여 AEM 인스턴스 간에 사용자 및 그룹을 마이그레이션할 수 있습니다. crx2oak 또는 오크 업그레이드 도구.

1. 사용 중인 Oak 버전과 일치하는 `crx2oak` 또는 `oak-upgrade` jar 다운로드: 
   1. Oak 업그레이드: [https://repo1.maven.org/maven2/org/apache/jackrabbit/oak-upgrade](https://repo1.maven.org/maven2/org/apache/jackrabbit/oak-upgrade)
   1. Crx2Oak: [Maven 저장소](https://mvnrepository.com/artifact/com.adobe.granite/crx2oak?repo=adobe-public)
1. AEM 서버에 jar 파일 업로드
1. AEM(소스 및 대상 인스턴스) 중지
1. 아래 명령에서 jar 파일의 이름을 바꿉니다.
1. 아래 명령의 *`--exclude-paths`* 일부 매개변수에서 *`/home/users/Q/QY5FIMXeQIbGpwZtQ3Dv,/home/users/K/Kj1406Qo9IDODc_nk5Ib`*&#x200B;를 소스 시스템의 관리자 및 익명 사용자 경로로 바꿉니다.
1. 인스턴스와 일치하도록 경로를 온라인에서 수정합니다(필요한 경우 경로 앞에 *`segment-old:`* 추가, 여기 참조[https://jackrabbit.apache.org/oak/docs/migration.html](https://jackrabbit.apache.org/oak/docs/migration.html)): *`/opt/aem-source/crx-quickstart/repository /opt/aem-destination/crx-quickstart/repository`*
1. 그런 다음 서버의 셸에서 명령을 실행합니다.

   ```
   java -Xms2g -Xmx2g -jar oak-upgrade-1.8.12.jar \
   --include-paths=/home \
   --merge-paths=/home \
   --exclude-paths=/home/users/Q/QY5FIMXeQIbGpwZtQ3Dv,/home/users/K/Kj1406Qo9IDODc_nk5Ib,/home/groups/a/administrators,/home/groups/a/analytics-administrators,/home/groups/c/community-moderators,/home/groups/c/content-authors,/home/groups/c/contributor,/home/groups/community/community-groupadmin,/home/groups/community/community-sitecontentmanager,/home/groups/community/community-sitemembers,/home/groups/d/dam-users,/home/groups/default/order-administrators,/home/groups/e/everyone,/home/groups/f/forms-users,/home/groups/forms/fd-administrators,/home/groups/forms/forms-users,/home/groups/geometrixx,/home/groups/media,/home/groups/o/operators,/home/groups/projects,/home/groups/t/tag-administrators,/home/groups/t/target-activity-authors,/home/groups/u/user-administrators,/home/groups/w/workflow-editors,/home/groups/w/workflow-users,/home/users/a/admin,/home/users/a/anonymous,/home/users/mac,/home/users/media,/home/users/projects,/home/users/system,/home/rep:policy,/home/users/rep:policy,/home/groups/rep:policy \
   segment-old:/opt/aem-source/crx-quickstart/repository /opt/aem-destination/crx-quickstart/repository  upgradeusers.log &
   ```

1. 완료되면 3단계로 이동하여 ACL을 마이그레이션합니다.  `crx2oak`를 사용하여 마이그레이션할 수 없는 경우 대신 아래 패키지 마이그레이션 단계를 따릅니다.

**2단계 B: 사용자 및 그룹 마이그레이션 (패키지 사용)**

LDAP/SAML 인증 또는 `CRX2Oak`(위의 방법 A)를 통해 사용자를 자동으로 가져오지 못한 경우 사용자와 그룹을 패키징할 수 있습니다.  이 경우 이전 시스템에서 두 개의 별도 패키지를 생성합니다(관리자와 기본 익명 사용자 제외).

1. 위의 1단계(“관리자 및 익명 사용자 찾기”) 결과에서 익명 및 관리 사용자 노드의 경로를 복사합니다.

   예:

   `/home/users/Q/QY5FIMXeQIbGpwZtQ3Dv` – 패키지를 생성하는 시스템의 관리자

   `/home/users/K/Kj1406Qo9IDODc_nk5Ib` – 패키지를 생성하는 시스템의 익명 사용자

1. “패키지 관리자”, *`http://host:port/crx/packmgr/index.jsp`*&#x200B;로 이동한 다음 관리자로 로그인합니다.
1. 패키지 “사용자” 만들기
1. 이 제외 규칙으로 `/home/users`의 패키지 구성에 필터 추가(`/home/users` 필터에서):
   1. `exclude /home/users/.\*/.tokens`
   1. `exclude /home/users/Q/QY5FIMXeQIbGpwZtQ3Dv`
   1. `exclude /home/users/K/Kj1406Qo9IDODc_nk5Ib`
   1. `exclude /home/users/a/admin`
   1. `exclude /home/users/a/anonymous`
   1. `exclude /home/users/system`
   1. `exclude /home/users/geometrixx`
   1. `exclude /home/users/media`
   1. `exclude /home/users/projects`
   1. `exclude /home/users/mac`
1. 패키지를 빌드합니다.
1. 패키지를 다운로드합니다.
1. 컴퓨터에서 패키지 zip 파일의 압축 풀기: `jar -xvf users.zip META-INF/vault/filter.xml`
1. 텍스트 편집기에서 파일 `META-INF/vault/filter.xml`를 엽니다.
1. 예: 필터 ... 태그에 `mode="merge"` 추가:

   ```
   ?xml version="1.0" encoding="UTF-8"?    workspaceFilter version="1.0"    filter root="/home/users" mode="merge"    exclude pattern="/home/users/.*/.tokens"/    exclude pattern="/home/users/Q/QY5FIMXeQIbGpwZtQ3Dv"/    exclude pattern="/home/users/K/Kj1406Qo9IDODc_nk5Ib"/    exclude pattern="/home/users/a/admin"/    exclude pattern="/home/users/a/anonymous"/    exclude pattern="/home/users/system"/    exclude pattern="/home/users/geometrixx"/    exclude pattern="/home/users/media"/    exclude pattern="/home/users/projects"/    exclude pattern="/home/users/mac"/    /filter    /workspaceFilter
   ```

1. 변경 사항이 포함되도록 수정된 패키지 콘텐츠를 다시 압축합니다.

   ```
   jar -uvf users.zip META-INF/vault/filter.xml
   ```

1. 필터 규칙 `/home/groups`가 포함된 “그룹” 패키지를 만듭니다.
1. 그룹 패키지의 경우 11~14단계를 반복합니다.
1. (업그레이드만 해당) 최신 AEM 버전으로 마이그레이션을 수행하는 경우 *이전 버전*&#x200B;의 새로운 로컬 AEM 인스턴스(nosamplecontent 포함)를 설치하고 사용자 패키지 다음에 그룹 패키지를 설치합니다. 그런 다음 해당 인스턴스에서 즉각적으로 새 버전으로 업그레이드합니다. 그러면 사용자가 새 Oak 표시로 변환됩니다. 즉각적으로 업그레이되면 사용자를 다시 패키징하여 업그레이드된 인스턴스로 복사합니다. 사용자 그룹에 대해서도 동일한 작업을 수행합니다.
1. 새 시스템에 사용자 패키지를 설치합니다.
1. 새 시스템에 그룹 패키지를 설치합니다.
1. 이전 AEM 버전에서 6.3으로 마이그레이션하는 경우 `/useradmin` UI로 이동한 다음 사용자 복제 수신기를 “관리자” 그룹에 추가합니다.

**3단계. ACL** 마이그레이션

AEM에 도구(ACS Commons)를 설치할 수 있는 경우 다음 단계를 따릅니다.

1. ACS Commons 다운로드 및 설치
1. 여기에 제공된 단계에 따라 ACL 패키지를 생성합니다.
1. http://aem-host:port/crx/packmgr/index.jsp로 이동한 다음 관리자로 로그인합니다.
1. [ACL 패키지]를 클릭합니다.
1. [편집]을 클릭합니다.
1. [!UICONTROL 고급] 탭을 선택합니다(아래 스크린샷 참조).
1. AC 처리 드롭다운 메뉴에서 [!UICONTROL 병합]을 선택하여 대상 시스템에서 기존 ACL이 제거되지 않도록 합니다. AEM의 다른 버전 간에 ACL을 마이그레이션하는 경우에 특히 중요합니다(기본 ACL이 제거되지 않으므로).

AEM에 도구(ACS Commons)를 설치할 수 *없는* 경우 다음 단계를 따릅니다. 이 명령을 실행하는 컴퓨터는 cURL, [!DNL Python] 및 [!DNL Java] SDK가 설치된 Mac OS, [!DNL Linux] 또는 [!DNL Windows]([!DNL Cygwin] 사용)이어야 합니다.

1. http://src-aem-host:port/crx/packmgr/index.jsp로 이동한 다음 관리자로 로그인합니다.
1. “ACL-migration”이라는 패키지 만들기
1. [편집] 버튼을 클릭합니다.
1. [!UICONTROL  고급] 탭을 클릭하고 AC 처리 모드를 병합으로 설정합니다.
1. 저장.
1. 패키지를 빌드하고 다운로드합니다.
1. 파일 시스템에서 패키지의 이 명령을 실행하여 `META-INF/vault/filter.xml` 파일을 추출합니다. 

   ```
   jar -xvf ACL-migration-1.0.zip META-INF/vault/filter.xml
   ```

1. 동일한 디렉터리에서 이 명령을 실행하여 소스 인스턴스의 `/content` 아래에 있는 ACL 경로의 json 파일을 다운로드합니다(사용자 이름 및 암호와 올바른 호스트 설정). 

   ```
   curl -u admin:admin 'http://aemhost/crx/de/query.jsp?' -G --data-urlencode '_dc=1507011481908&_charset_=utf-8&type=xpath&stmt=/jcr:root/content//element(*,rep:ACL)&showResults=true'  data.json
   ```

1. 파일 `generate-package-filter.py`을 만들고 내부에 있는 아래 코드 [!DNL Python]를 붙여넣습니다. 

   ```
   import json
   from pprint import pprint
   
   with open ('data.json') as data_file:
      data = json.load(data_file)
   
   print("?xml version=\"1.0\" encoding=\"UTF-8\"?")
   print("workspaceFilter version=\"1.0\"")
   
   for item in data "results":
       print("filter root=\"{path}\" /" . format(path=item "path"))
   
   print( "/workspaceFilter")
   ```

1. data.json이 생성된 동일한 폴더에서 [!DNL Python] 스크립트를 만들고 출력을 `META-INF/vault/filter.xml`에 저장합니다(`filter.xml`의 기존 콘텐츠 대체). 

   ```
   python generate-packge-filter.py  META-INF/vault/filter.xml
   ```

1. 이 명령을 사용하여 zip 파일 내에서 `filter.xml`를 업데이트합니다.

   ```
   jar -uvf ACL-migration-1.0.zip META-INF/vault/filter.xml
   ```

1. Zip 파일을 소스 인스턴스 패키지 관리자에 업로드합니다. http://src-aem-host:port/crx/packmgr/index.jsp
1. [!UICONTROL 빌드] 또는 [!UICONTROL 다시 빌드]를 클릭하여 패키지를 빌드합니다.
1. 소스 AEM 서버에서 패키지를 다운로드합니다.
1. 패키지를 대상 AEM 서버의 패키지 관리자에 업로드합니다. http://dst-aem-host:port/crx/packmgr/index.jsp
1. [!UICONTROL 설치]를 클릭하여 설치합니다.
1. 경로 curl 명령을 변경하는 다른 경로에 대해 8~16단계를 반복합니다. 예를 들어 `/content` 대신에 `/etc` 아래에서 ACL을 가져옵니다.

   ```
   curl -u admin:admin 'http://aemhost/crx/de/query.jsp?' -G --data-urlencode '_dc=1507011481908&_charset_=utf-8&type=xpath&stmt=/jcr:root/etc//element(*,rep:ACL)&showResults=true'  data.json` |
   ```
