---
title: AEM 인스턴스 간에 사용자, 그룹 및 ACL 마이그레이션
description: 설명
solution: Experience Manager
product: Experience Manager
applies-to: Experience Manager
keywords: KCS
resolution: Resolution
internal-notes: 'Helpx Link: https://helpx.adobe.com/experience-manager/kb/migrate-users-groups-ACLs.html ; Contains Docs links that may need to be changed'
bug: false
article-created-by: Gucci Paull
article-created-date: 6/21/2022 6:07:06 PM
article-published-by: Gucci Paull
article-published-date: 6/21/2022 6:07:59 PM
version-number: 8
article-number: KA-16448
dynamics-url: https://adobe-ent.crm.dynamics.com/main.aspx?forceUCI=1&pagetype=entityrecord&etn=knowledgearticle&id=d7ce3bf2-8cf1-ec11-bb3d-6045bd015716
exl-id: 5c285ad4-da35-4ee4-b3d1-3ac9eea5f5b2
source-git-commit: af761579c3fb5e51cf5f4d144bff0e058fd13911
workflow-type: tm+mt
source-wordcount: '960'
ht-degree: 1%

---

# AEM 인스턴스 간에 사용자, 그룹 및 ACL 마이그레이션

## 설명

AEM에서 한 서버에서 다른 서버로 또는 하나의 AEM 인스턴스에서 다른 서버로 ACL 권한이 있는 사용자 및 그룹을 마이그레이션하는 방법입니다.

## 해상도

**1단계: 관리자 및 익명 사용자 찾기**

1. CRXDE Lite 앱으로 이동 `/crx/de/index.jsp` 관리 사용자로 로그인(소스 시스템에서)
1. &quot;Tools&quot; = &quot;Query&quot;로 이동합니다.
1. 아래의 &quot;쿼리&quot; 상자에 이 쿼리를 입력하여 관리자 사용자를 찾습니다. *`/jcr:root/home/users//element(\*,rep:User)@rep:principalName="admin" .`*
1. 실행 을 클릭하고 결과에 있는 관리자 사용자 노드의 경로를 텍스트 파일에 복사합니다.
1. 익명 사용자에 대한 쿼리를 사용하여 3단계를 반복합니다. *`/jcr:root/home/users//element(\*,rep:User)@rep:principalName="anonymous" .`*
1. &quot;실행&quot;을 클릭하고 결과에 있는 익명 사용자 노드의 경로를 텍스트 파일에 복사합니다. 이제 두 개의 경로가 있습니다. 하나는 &quot;admin&quot;이고 다른 하나는 &quot;anonymous&quot;입니다.

   예:

   `/home/users/Q/QY5FIMXeQIbGpwZtQ3Dv` - 소스 시스템의 관리자 사용자

   `/home/users/K/Kj1406Qo9IDODc_nk5Ib` - 소스 시스템의 익명 사용자

**2A단계: 사용자 및 그룹 마이그레이션(사용) `crx2oak` 또는 `oak-upgrade`)**

사용자와 그룹은 [crx2oak](https://helpx.adobe.com/experience-manager/6-4/sites/deploying/using/using-crx2oak.html) 또는 [oak 업그레이드](https://jackrabbit.apache.org/oak/docs/migration.html) 도구.

1. 다운로드 `crx2oak` 또는 `oak-upgrade` 사용 중인 Oak 버전과 일치하는 jar: 
   1. Oak 업그레이드: [https://repo1.maven.org/maven2/org/apache/jackrabbit/oak-upgrade](https://repo1.maven.org/maven2/org/apache/jackrabbit/oak-upgrade)
   1. Crx2Oak: [Maven 저장소](https://mvnrepository.com/artifact/com.adobe.granite/crx2oak?repo=adobe-public)
1. jar 파일을 AEM 서버에 업로드합니다
1. AEM 중지(소스 및 대상 인스턴스)
1. 아래 명령에서 jar 파일의 이름을 바꿉니다.
1. 바꾸기 *`/home/users/Q/QY5FIMXeQIbGpwZtQ3Dv,/home/users/K/Kj1406Qo9IDODc_nk5Ib`* 에서 *`--exclude-paths`* 아래 명령의 일부 매개 변수와 함께 소스 시스템의 admin 및 anonymous 사용자 경로를 사용합니다.
1. 인스턴스와 일치하도록 라인에서 경로를 수정합니다(추가). *`segment-old:`* 필요한 경우 경로 전에 여기 를 참조하십시오. [https://jackrabbit.apache.org/oak/docs/migration.html](https://jackrabbit.apache.org/oak/docs/migration.html)): *`/opt/aem-source/crx-quickstart/repository /opt/aem-destination/crx-quickstart/repository`*
1. 그런 다음 서버의 셸에서 명령을 실행합니다.

   ```
   java -Xms2g -Xmx2g -jar oak-upgrade-1.8.12.jar \
   --include-paths=/home \
   --merge-paths=/home \
   --exclude-paths=/home/users/Q/QY5FIMXeQIbGpwZtQ3Dv,/home/users/K/Kj1406Qo9IDODc_nk5Ib,/home/groups/a/administrators,/home/groups/a/analytics-administrators,/home/groups/c/community-moderators,/home/groups/c/content-authors,/home/groups/c/contributor,/home/groups/community/community-groupadmin,/home/groups/community/community-sitecontentmanager,/home/groups/community/community-sitemembers,/home/groups/d/dam-users,/home/groups/default/order-administrators,/home/groups/e/everyone,/home/groups/f/forms-users,/home/groups/forms/fd-administrators,/home/groups/forms/forms-users,/home/groups/geometrixx,/home/groups/media,/home/groups/o/operators,/home/groups/projects,/home/groups/t/tag-administrators,/home/groups/t/target-activity-authors,/home/groups/u/user-administrators,/home/groups/w/workflow-editors,/home/groups/w/workflow-users,/home/users/a/admin,/home/users/a/anonymous,/home/users/mac,/home/users/media,/home/users/projects,/home/users/system,/home/rep:policy,/home/users/rep:policy,/home/groups/rep:policy \
   segment-old:/opt/aem-source/crx-quickstart/repository /opt/aem-destination/crx-quickstart/repository  upgradeusers.log &
   ```

1. 완료되면 3단계로 이동하여 ACL을 마이그레이션합니다.  을 사용하여 마이그레이션할 수 없는 경우 `crx2oak` 그런 다음 아래의 패키지 마이그레이션 단계를 대신 따르십시오.

**2B단계: 사용자 및 그룹 마이그레이션(패키지 사용)**

사용자가 LDAP/SAML 인증을 통해 자동으로 가져오지 않은 경우 또는 `CRX2Oak` (위의 방법)에서 사용자와 그룹을 패키지할 수 있습니다.  이 경우 이전 시스템에서 별도의 패키지 2개를 만듭니다(관리자 및 익명의 기본 사용자 제외).

1. 위의 1단계(&quot;관리자 및 익명 사용자 찾기&quot;)의 결과에서 익명 및 관리자 사용자 노드의 경로를 복사합니다.

   예:

   `/home/users/Q/QY5FIMXeQIbGpwZtQ3Dv` - 패키지를 만드는 시스템의 관리 사용자

   `/home/users/K/Kj1406Qo9IDODc_nk5Ib` - 패키지를 만드는 시스템의 익명 사용자

1. &quot;패키지 관리자&quot;로 이동합니다. *`http://host:port/crx/packmgr/index.jsp`*, 그리고 관리자로 로그인합니다.
1. 패키지 &quot;사용자&quot; 만들기
1. 다음에 대한 패키지 구성에 필터 추가 `/home/users` 다음 제외 규칙 사용( `/home/users` 필터):
   1. `exclude /home/users/.\*/.tokens`
   1. `exclude /home/users/Q/QY5FIMXeQIbGpwZtQ3Dv`
   1. `exclude /home/users/K/Kj1406Qo9IDODc_nk5Ib`
   1. `exclude /home/users/a/admin`
   1. `exclude /home/users/a/anonymous`
   1. `exclude /home/users/system`
   1. `exclude /home/users/geometrixx`
   1. `exclude /home/users/media`
   1. `exclude /home/users/projects`
   1. `exclude /home/users/mac`
1. 패키지를 빌드합니다.
1. 패키지를 다운로드합니다.
1. 컴퓨터에서 패키지 zip 파일의 압축을 해제합니다. `jar -xvf users.zip META-INF/vault/filter.xml`
1. 파일을 엽니다. `META-INF/vault/filter.xml` 텍스트 편집기에서 을 참조하십시오.
1. 추가 `mode="merge"` 필터 ... 태그로 이동합니다. 예를 들면 다음과 같습니다.

   ```
   ?xml version="1.0" encoding="UTF-8"?    workspaceFilter version="1.0"    filter root="/home/users" mode="merge"    exclude pattern="/home/users/.*/.tokens"/    exclude pattern="/home/users/Q/QY5FIMXeQIbGpwZtQ3Dv"/    exclude pattern="/home/users/K/Kj1406Qo9IDODc_nk5Ib"/    exclude pattern="/home/users/a/admin"/    exclude pattern="/home/users/a/anonymous"/    exclude pattern="/home/users/system"/    exclude pattern="/home/users/geometrixx"/    exclude pattern="/home/users/media"/    exclude pattern="/home/users/projects"/    exclude pattern="/home/users/mac"/    /filter    /workspaceFilter
   ```

1. 변경 사항이 포함되도록 수정된 패키지 내용을 다시 압축합니다.

   ```
   jar -uvf users.zip META-INF/vault/filter.xml
   ```

1. 필터 규칙이 포함된 &quot;그룹&quot; 패키지 만들기 `/home/groups`.
1. 그룹 패키지에 대해 11~14단계를 반복합니다.
1. (업그레이드만 해당) 최신 AEM 버전으로 마이그레이션을 수행하는 경우 새 로컬 AEM 인스턴스를 설치합니다 *이전 버전의*(nosamplecontent 포함) 사용 후 사용자 패키지를 설치한 다음 그룹 패키지를 설치 합니다. 그런 다음 해당 인스턴스의 새 버전으로 업그레이드하십시오 . 그러면 사용자가 새 Oak 표현으로 변환됩니다. 즉각적인 업그레이드 후 사용자를 다시 패키징하여 의도한 업그레이드된 인스턴스에 포팅하십시오. 사용자 그룹에 대해서도 동일한 작업을 수행합니다.
1. 새 시스템에 사용자 패키지를 설치합니다.
1. 새 시스템에 그룹 패키지를 설치합니다.
1. 이전 AEM 버전에서 6.3으로 마이그레이션하는 경우 `/useradmin` UI를 생성하고 사용자 복제 수신기를 &quot;관리자&quot; 그룹에 추가합니다.

**3단계. ACL 마이그레이션**

AEM에 도구(ACS Commons)를 설치할 수 있는 경우 다음 단계를 수행하십시오.

1. ACS Commons를 다운로드하여 설치합니다.
1. 여기에 제공된 단계에 따라 ACL 패키지를 만듭니다.
1. http://aem-host:port/crx/packmgr/index.jsp and으로 이동하여 관리자로 로그인합니다.
1. ACL 패키지를 클릭합니다.
1. 편집을 클릭합니다.
1. 을(를) 선택합니다 [!UICONTROL 고급] 탭(아래 스크린샷 참조).
1. AC 처리 드롭다운 메뉴에서 [!UICONTROL 병합] 대상 시스템에서 기존 ACL을 제거하지 마십시오. 이 기능은 AEM의 다른 버전 간에 ACL을 마이그레이션할 때 특히 중요한 역할을 합니다. ACL이 즉시 제거되기 때문입니다.

만약 *not* 도구(ACS Commons)를 AEM에 설치한 다음 다음 단계를 따르십시오. 이러한 명령을 실행하는 컴퓨터는 Mac OS여야 합니다. [!DNL Linux], 또는 [!DNL Windows] (사용 [!DNL Cygwin]). [!DNL Python], 및 [!DNL Java] SDK가 설치되었습니다.

1. http://src-aem-host:port/crx/packmgr/index.jsp and으로 이동하여 관리자로 로그인합니다.
1. &quot;ACL-migration&quot; 패키지를 만듭니다.
1. 편집 단추를 클릭합니다.
1. 을(를) 선택합니다 [!UICONTROL 고급] 탭을 선택하고 AC 처리 모드를 병합으로 설정합니다.
1. 저장.
1. 패키지를 빌드하고 다운로드합니다.
1. 파일 시스템에서 패키지에서 이 명령을 실행하여 `META-INF/vault/filter.xml` 파일: 

   ```
   jar -xvf ACL-migration-1.0.zip META-INF/vault/filter.xml
   ```

1. 동일한 디렉토리에서 이 명령을 실행하여 아래의 ACL 경로의 json 파일을 다운로드합니다 `/content` 소스 인스턴스(사용자 이름과 암호 설정 및 올바른 호스트): 

   ```
   curl -u admin:admin 'http://aemhost/crx/de/query.jsp?' -G --data-urlencode '_dc=1507011481908&_charset_=utf-8&type=xpath&stmt=/jcr:root/content//element(*,rep:ACL)&showResults=true'  data.json
   ```

1. 파일 만들기 `generate-package-filter.py` 붙여넣고 [!DNL Python] 아래의 코드: 

   ```
   import json
   from pprint import pprint
   
   with open ('data.json') as data_file:
      data = json.load(data_file)
   
   print("?xml version=\"1.0\" encoding=\"UTF-8\"?")
   print("workspaceFilter version=\"1.0\"")
   
   for item in data "results":
       print("filter root=\"{path}\" /" . format(path=item "path"))
   
   print( "/workspaceFilter")
   ```

1. 를 실행합니다. [!DNL Python] data.json이 작성된 동일한 폴더의 스크립트를에 저장하고 출력을 `META-INF/vault/filter.xml` (기존 내용 바꾸기) `filter.xml`): 

   ```
   python generate-packge-filter.py  META-INF/vault/filter.xml
   ```

1. 이 명령을 사용하여 `filter.xml` zip 파일 내에서:

   ```
   jar -uvf ACL-migration-1.0.zip META-INF/vault/filter.xml
   ```

1. zip 파일을 소스 인스턴스 패키지 관리자에 업로드합니다. http://src-aem-host:port/crx/packmgr/index.jsp
1. 클릭 [!UICONTROL 빌드] 또는 [!UICONTROL 다시 빌드] 패키지를 빌드하려면 다음을 수행하십시오.
1. 소스 AEM 서버에서 패키지를 다운로드합니다.
1. 대상 AEM 서버의 패키지 관리자 http://dst-aem-host:port/crx/packmgr/index.jsp에 패키지를 업로드합니다.
1. 클릭 [!UICONTROL 설치] 를 설치합니다.
1. 경로 curl 명령을 변경하는 다른 경로에 대해 8~16단계를 반복합니다. 예를 들어 ACL은 `/etc` 대신 `/content`:

   ```
   curl -u admin:admin 'http://aemhost/crx/de/query.jsp?' -G --data-urlencode '_dc=1507011481908&_charset_=utf-8&type=xpath&stmt=/jcr:root/etc//element(*,rep:ACL)&showResults=true'  data.json` |
   ```
