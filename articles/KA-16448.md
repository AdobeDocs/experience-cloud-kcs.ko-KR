---
title: AEM 인스턴스 간에 사용자, 그룹 및 ACL 마이그레이션
description: 설명
solution: Experience Manager
product: Experience Manager
applies-to: Experience Manager
keywords: KCS
resolution: Resolution
internal-notes: 'Helpx Link: https://helpx.adobe.com/experience-manager/kb/migrate-users-groups-ACLs.html ; Contains Docs links that may need to be changed'
bug: false
article-created-by: Gucci Paull
article-created-date: 6/21/2022 6:07:06 PM
article-published-by: Gucci Paull
article-published-date: 6/21/2022 6:07:59 PM
version-number: 8
article-number: KA-16448
dynamics-url: https://adobe-ent.crm.dynamics.com/main.aspx?forceUCI=1&pagetype=entityrecord&etn=knowledgearticle&id=d7ce3bf2-8cf1-ec11-bb3d-6045bd015716
exl-id: 5c285ad4-da35-4ee4-b3d1-3ac9eea5f5b2
source-git-commit: e8f4ca2dd578944d4fe399074fab461de88ad247
workflow-type: tm+mt
source-wordcount: '1132'
ht-degree: 1%

---

# AEM 인스턴스 간에 사용자, 그룹 및 ACL 마이그레이션

## 설명


AEM에서 한 서버에서 다른 서버로 또는 하나의 AEM 인스턴스에서 다른 서버로 ACL 권한이 있는 사용자 및 그룹을 마이그레이션하는 방법입니다.


## 해상도


<b>1단계: 관리자 및 익명 사용자 찾기</b>

1. CRXDE Lite 앱 /crx/de/index.jsp으로 이동한 다음 관리 사용자로 로그인합니다(소스 시스템에서).
2. &quot;Tools&quot; = &quot;Query&quot;로 이동합니다.
3. 아래의 &quot;쿼리&quot; 상자에 이 쿼리를 입력하여 관리자 사용자를 찾습니다. */jcr:root/home/users//element(\*,rep:user)@rep:principalName=&quot;admin&quot; .*
4. 실행 을 클릭하고 결과에 있는 관리자 사용자 노드의 경로를 텍스트 파일에 복사합니다.
5. 익명 사용자에 대한 쿼리를 사용하여 3단계를 반복합니다. */jcr:root/home/users//element(\*,rep:user)@rep:principalName=&quot;anonymous&quot; .*
6. &quot;실행&quot;을 클릭하고 결과에 있는 익명 사용자 노드의 경로를 텍스트 파일에 복사합니다. 이제 두 개의 경로가 있습니다. 하나는 &quot;admin&quot;이고 다른 하나는 &quot;anonymous&quot;입니다.



   예:

   /home/users/Q/QY5FIMXeQIbGpwZtQ3Dv - 소스 시스템의 관리자 사용자

   /home/users/K/Kj1406Qo9IDODc_nk5Ib - 소스 시스템의 익명 사용자


<b>2A단계: 사용자 및 그룹 마이그레이션(crx2oak 또는 oak-upgrade 사용)</b>

사용자와 그룹은 [crx2oak](https://helpx.adobe.com/experience-manager/6-4/sites/deploying/using/using-crx2oak.html) 또는 [oak 업그레이드](https://jackrabbit.apache.org/oak/docs/migration.html) 도구.

1. 사용 중인 Oak 버전과 일치하는 crx2oak 또는 oak-upgrade jar를 다운로드합니다. 
   1. Oak 업그레이드: [https://repo1.maven.org/maven2/org/apache/jackrabbit/oak-upgrade](https://repo1.maven.org/maven2/org/apache/jackrabbit/oak-upgrade)
   2. Crx2Oak: [Maven 저장소](https://mvnrepository.com/artifact/com.adobe.granite/crx2oak?repo=adobe-public)
2. jar 파일을 AEM 서버에 업로드합니다
3. AEM 중지(소스 및 대상 인스턴스)
4. 아래 명령에서 jar 파일의 이름을 바꿉니다.
5. 바꾸기 */home/users/Q/QY5FIMXeQIbGpwZtQ3Dv,/home/users/K/Kj1406Qo9IDODc_nk5Ib* 에서 *—exclude-paths* 아래 명령의 일부 매개 변수와 함께 소스 시스템의 admin 및 anonymous 사용자 경로를 사용합니다.
6. 인스턴스와 일치하도록 라인에서 경로를 수정합니다(추가). *segment-old:* 필요한 경우 경로 전에 여기 를 참조하십시오. [https://jackrabbit.apache.org/oak/docs/migration.html](https://jackrabbit.apache.org/oak/docs/migration.html)): */opt/aem-source/crx-quickstart/repository/opt/aem-destination/crx-quickstart/repository*
7. 그런 다음 서버의 셸에서 명령을 실행합니다.     `java -Xms2g -Xmx2g -jar oak-upgrade-1.8.12.jar \`

   `--include-paths=/home \`
   `--merge-paths=/home \`
   `--exclude-paths=/home/users/Q/QY5FIMXeQIbGpwZtQ3Dv,/home/users/K/Kj1406Qo9IDODc_nk5Ib,/home/groups/a/administrators,/home/groups/a/analytics-administrators,/home/groups/c/community-moderators,/home/groups/c/content-authors,/home/groups/c/contributor,/home/groups/community/community-groupadmin,/home/groups/community/community-sitecontentmanager,/home/groups/community/community-sitemembers,/home/groups/d/dam-users,/home/groups/default/order-administrators,/home/groups/e/everyone,/home/groups/f/forms-users,/home/groups/forms/fd-administrators,/home/groups/forms/forms-users,/home/groups/geometrixx,/home/groups/media,/home/groups/o/operators,/home/groups/projects,/home/groups/t/tag-administrators,/home/groups/t/target-activity-authors,/home/groups/u/user-administrators,/home/groups/w/workflow-editors,/home/groups/w/workflow-users,/home/users/a/admin,/home/users/a/anonymous,/home/users/mac,/home/users/media,/home/users/projects,/home/users/system,/home/rep:policy,/home/users/rep:policy,/home/groups/rep:policy \`
   `segment-old:/opt/aem-source/crx-quickstart/repository /opt/aem-destination/crx-quickstart/repository  upgradeusers.log &`
8. 완료되면 3단계로 이동하여 ACL을 마이그레이션합니다.  crx2oak를 사용하여 마이그레이션할 수 없는 경우 대신 아래의 패키지 마이그레이션 단계를 따르십시오.


<b>2B단계: 사용자 및 그룹 마이그레이션(패키지 사용)</b>

LDAP/SAML 인증 또는 CRX2Oak(위의 방법 A)를 통해 사용자를 자동으로 가져오지 않은 경우 사용자 및 그룹을 패키지할 수 있습니다.  이 경우 이전 시스템에서 별도의 패키지 2개를 만듭니다(관리자 및 익명의 기본 사용자 제외).

1. 위의 1단계(&quot;관리자 및 익명 사용자 찾기&quot;)의 결과에서 익명 및 관리자 사용자 노드의 경로를 복사합니다.

   예:

   /home/users/Q/QY5FIMXeQIbGpwZtQ3Dv - 패키지를 만드는 시스템의 관리자 사용자

   /home/users/K/Kj1406Qo9IDODc_nk5Ib - 패키지를 만드는 시스템의 익명 사용자
2. &quot;패키지 관리자&quot;로 이동합니다. *http://host:port/crx/packmgr/index.jsp*, 그리고 관리자로 로그인합니다.
3. 패키지 &quot;사용자&quot; 만들기
4. 이러한 제외 규칙(/home/users 필터에서)을 사용하여 /home/users용 패키지 구성에 필터를 추가합니다.
   1. /home/users/ 제외\*/.tokens
   2. 제외 /home/users/Q/QY5FIMXeQIbGpwZtQ3Dv
   3. /home/users/K/Kj1406Qo9IDODc_nk5Ib 제외
   4. /home/users/a/admin 제외
   5. exclude /home/users/a/anonymous
   6. /home/users/system 제외
   7. /home/users/geometrixx 제외
   8. /home/users/media 제외
   9. /home/users/projects 제외
   10. /home/users/mac 제외
5. 패키지를 빌드합니다.
6. 패키지를 다운로드합니다.
7. 컴퓨터에서 패키지 zip 파일의 압축을 해제합니다. `jar -xvf users.zip META-INF/vault/filter.xml`
8. 텍스트 편집기에서 파일 META-INF/vault/filter.xml 을 엽니다.
9. 필터 .. 태그에 mode=&quot;merge&quot;를 추가합니다(예:






   ```
   ?xml version="1.0" encoding="UTF-8"?    workspaceFilter version="1.0"    filter root="/home/users" mode="merge"    exclude pattern="/home/users/.*/.tokens"/    exclude pattern="/home/users/Q/QY5FIMXeQIbGpwZtQ3Dv"/    exclude pattern="/home/users/K/Kj1406Qo9IDODc_nk5Ib"/    exclude pattern="/home/users/a/admin"/    exclude pattern="/home/users/a/anonymous"/    exclude pattern="/home/users/system"/    exclude pattern="/home/users/geometrixx"/    exclude pattern="/home/users/media"/    exclude pattern="/home/users/projects"/    exclude pattern="/home/users/mac"/    /filter    /workspaceFilter
   ```




10. 변경 사항이 포함되도록 수정된 패키지 내용을 다시 압축합니다.

   `jar -uvf users.zip META-INF/vault/filter.xml`
11. 필터 규칙 /home/groups를 포함하는 &quot;groups&quot; 패키지를 만듭니다.
12. 그룹 패키지에 대해 11~14단계를 반복합니다.
13. (업그레이드만 해당) 최신 AEM 버전으로 마이그레이션을 수행하는 경우 새 로컬 AEM 인스턴스를 설치합니다 *이전 버전의*(nosamplecontent 포함) 사용 후 사용자 패키지를 설치한 다음 그룹 패키지를 설치 합니다. 그런 다음 해당 인스턴스의 새 버전으로 업그레이드하십시오 . 그러면 사용자가 새 Oak 표현으로 변환됩니다. 즉각적인 업그레이드 후 사용자를 다시 패키징하여 의도한 업그레이드된 인스턴스에 포팅하십시오. 사용자 그룹에 대해서도 동일한 작업을 수행합니다.
14. 새 시스템에 사용자 패키지를 설치합니다.
15. 새 시스템에 그룹 패키지를 설치합니다.
16. 이전 AEM 버전에서 6.3으로 마이그레이션하는 경우 /useradmin UI로 이동하고 사용자 복제 수신기를 &quot;administrators&quot; 그룹에 추가합니다.




<b>3단계. ACL 마이그레이션</b>

AEM에 도구(ACS Commons)를 설치할 수 있는 경우 다음 단계를 수행하십시오.

1. ACS Commons를 다운로드하여 설치합니다.
2. 여기에 제공된 단계에 따라 ACL 패키지를 만듭니다.
3. http://aem-host:port/crx/packmgr/index.jsp and으로 이동하여 관리자로 로그인합니다.
4. ACL 패키지를 클릭합니다.
5. 편집을 클릭합니다.
6. 고급 탭을 선택합니다(아래 스크린샷 참조).
7. AC 처리 드롭다운 메뉴에서 병합을 선택하여 대상 시스템의 기존 ACL을 제거하지 마십시오. 이 기능은 AEM의 다른 버전 간에 ACL을 마이그레이션할 때 특히 중요한 역할을 합니다. ACL이 즉시 제거되기 때문입니다.


만약 *not* 도구(ACS Commons)를 AEM에 설치한 다음 다음 단계를 따르십시오. 이러한 명령을 실행하는 컴퓨터는 cURL, python 및 Java SDK가 설치된 Mac OS, Linux 또는 Windows(Cygwin 사용)여야 합니다.

1. http://src-aem-host:port/crx/packmgr/index.jsp and으로 이동하여 관리자로 로그인합니다.
2. &quot;ACL-migration&quot; 패키지를 만듭니다.
3. 편집 단추를 클릭합니다.
4. 고급 탭을 선택하고 AC 처리 모드를 병합으로 설정합니다.
5. 저장.
6. 패키지를 빌드하고 다운로드합니다.
7. 파일 시스템에서 이 명령을 패키지에서 실행하여 META-INF/vault/filter.xml 파일을 추출합니다. 

   `jar -xvf ACL-migration-1.0.zip META-INF/vault/filter.xml`


8. 동일한 디렉토리에서 이 명령을 실행하여 소스 인스턴스의 /content 아래에 있는 ACL 경로의 json 파일을 다운로드합니다(사용자 이름과 암호 설정 및 올바른 호스트 설정). 

   `curl -u admin:admin 'http://aemhost/crx/de/query.jsp?' -G --data-urlencode '_dc=1507011481908&_charset_=utf-8&type=xpath&stmt=/jcr:root/content//element(*,rep:ACL)&showResults=true'  data.json`


9. 파일 generate-package-filter.py를 만들고 그 안에 python 코드를 붙여 넣습니다. 

   `import` `json`


   `from pprint import` `pprint`





   `with open` `(` `'data.json') as data_file:`


   `    data = json.load(data_file)`





   `print("?xml version=\"1.0\" encoding=\"UTF-8\"?")`


   `print(` `"workspaceFilter version=\"1.0\""` `)`


   `for` `item ` `in` `data` `"results"` `:`


   `    ` `print(` `"filter root=\"{path}\" /"` `.` `format` `(path=item` `"path"` `))`


   `print(` `"/workspaceFilter"` `)`
10. data.json을 만든 동일한 폴더에서 python 스크립트를 실행하고 META-INF/vault/filter.xml으로 출력을 저장합니다(filter.xml의 기존 내용을 대체). 

   `python generate-packge-filter.py  META-INF/vault/filter.xml`


11. 이 명령을 사용하여 zip 파일 내의 filter.xml을 업데이트합니다.

   `jar -uvf ACL-migration-1.0.zip META-INF/vault/filter.xml`


12. zip 파일을 소스 인스턴스 패키지 관리자에 업로드합니다. http://src-aem-host:port/crx/packmgr/index.jsp
13. 빌드 또는 재구축 을 클릭하여 패키지를 빌드합니다.
14. 소스 AEM 서버에서 패키지를 다운로드합니다.
15. 대상 AEM 서버의 패키지 관리자 http://dst-aem-host:port/crx/packmgr/index.jsp에 패키지를 업로드합니다.
16. 설치 를 클릭하여 설치합니다.
17. 경로 curl 명령을 변경하는 다른 경로에 대해 8~16단계를 반복합니다. 예를 들어 /content 대신 /etc 아래에 ACL이 가져옵니다. 

   | <br><br><br>`curl -u admin:admin 'http://aemhost/crx/de/query.jsp?' -G --data-urlencode '_dc=1507011481908&_charset_=utf-8&type=xpath&stmt=/jcr:root/etc//element(*,rep:ACL)&showResults=true'  data.json` |
   | --- |
